Source URL: https://developers.google.com/maps/documentation/ios-sdk/current-place-tutorial?hl=ko
Title: 지도에서 현재 장소 선택 및 세부정보 표시하기

의견 보내기

컬렉션을 사용해 정리하기

내 환경설정을 기준으로 콘텐츠를 저장하고 분류하세요.

지도에서 현재 장소 선택 및 세부정보 표시하기

이 튜토리얼에서는 기기의 현재 위치를 가져오고, 가능성이 높은 위치를 식별하고, 사용자에게 가장 적합한 위치를 선택하라는 메시지를 표시하고, 선택한 위치의 지도 마커를 표시하는 iOS 앱을 빌드하는 방법을 보여줍니다.

Swift 또는 Objective-C에 관한 초급 또는 중급 수준의 지식과 Xcode에 관한 일반적인 지식이 있는 사용자에게 적합합니다. 지도 만들기에 관한 고급 가이드는 개발자 가이드 [https://developers.google.com/maps/documentation/ios-sdk?hl=ko]를 참고하세요.

이 튜토리얼을 사용하여 다음과 같은 지도를 만듭니다. 지도 마커는 캘리포니아주 샌프란시스코에 배치되지만 기기나 시뮬레이터가 있는 곳으로 이동합니다.

이 튜토리얼에서는 iOS용 Places SDK [https://developers.google.com/maps/documentation/places/ios-sdk?hl=ko], iOS용 Maps SDK [https://developers.google.com/maps/documentation/ios-sdk?hl=ko], Apple Core Location 프레임워크 [https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/LocationAwarenessPG/CoreLocation/CoreLocation.html#//apple_ref/doc/uid/TP40009497-CH2-SW1]를 사용합니다.

코드 가져오기

GitHub에서 Google Maps iOS 샘플 저장소 [https://github.com/googlemaps-samples/maps-sdk-for-ios-samples]를 클론하거나 다운로드합니다.
또는 다음 버튼을 클릭하여 소스 코드를 다운로드합니다.
코드 받기 [https://github.com/googlemaps-samples/maps-sdk-for-ios-samples/archive/main.zip]

MapViewController

Swift
import UIKit
import GoogleMaps
import GooglePlaces

class MapViewController: UIViewController {

marker.snippet = selectedPlace?.formattedAddress
marker.map = mapView

locationManager.desiredAccuracy = kCLLocationAccuracyBest
locationManager.requestWhenInUseAuthorization()
locationManager.distanceFilter = 50
locationManager.startUpdatingLocation()
locationManager.delegate = self

placesClient = GMSPlacesClient.shared()

mapView.autoresizingMask = [.flexibleWidth, .flexibleHeight]
mapView.isMyLocationEnabled = true

mapView.isHidden = true

listLikelyPlaces()

return
mapView.camera = camera
case .reducedAccuracy:
print("Location accuracy is not precise.")
@unknown default:
fatalError()
case .denied:
print("User denied access to location.")
case .notDetermined:
print("Location status not determined.")
case .authorizedAlways: fallthrough
case .authorizedWhenInUse:
print("Location status is OK.")
@unknown default:
fatalError()
print("Error: \(error)")
Objective-C
#import "MapViewController.h"
#import "PlacesViewController.h"
@import CoreLocation;
@import GooglePlaces;
@import GoogleMaps;

@interface MapViewController () <CLLocationManagerDelegate>

@end

@implementation MapViewController {
CLLocationManager *locationManager;
CLLocation * _Nullable currentLocation;
GMSMapView *mapView;
GMSPlacesClient *placesClient;
float preciseLocationZoomLevel;
float approximateLocationZoomLevel;

NSMutableArray<GMSPlace *> *likelyPlaces;

GMSPlace * _Nullable selectedPlace;
preciseLocationZoomLevel = 15.0;
approximateLocationZoomLevel = 15.0;

locationManager.desiredAccuracy = kCLLocationAccuracyBest;
[locationManager requestWhenInUseAuthorization];
locationManager.distanceFilter = 50;
[locationManager startUpdatingLocation];
locationManager.delegate = self;

placesClient = [GMSPlacesClient sharedClient];

CLLocationCoordinate2D defaultLocation = CLLocationCoordinate2DMake(-33.869405, 151.199);

GMSCameraPosition *camera = [GMSCameraPosition cameraWithLatitude:defaultLocation.latitude
longitude:defaultLocation.longitude
mapView.settings.myLocationButton = YES;
mapView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
mapView.myLocationEnabled = YES;

mapView.hidden = YES;

[self listLikelyPlaces];

GMSPlaceField placeFields = GMSPlaceFieldName | GMSPlaceFieldCoordinate;
[placesClient findPlaceLikelihoodsFromCurrentLocationWithPlaceFields:placeFields callback:^(NSArray<GMSPlaceLikelihood *> * _Nullable likelihoods, NSError * _Nullable error) {
if (error != nil) {
NSLog(@"Current Place error: %@", error.localizedDescription);
return;
NSLog(@"No places found.");
return;
GMSPlace *place = likelihood.place;
[likelyPlaces addObject:place];

GMSMarker *marker = [GMSMarker markerWithPosition:selectedPlace.coordinate];
marker.title = selectedPlace.name;
marker.snippet = selectedPlace.formattedAddress;
marker.map = mapView;
PlacesViewController *placesViewController = (PlacesViewController *)segue.destinationViewController;
placesViewController.likelyPlaces = likelyPlaces;
CLLocation *location = locations.lastObject;
NSLog(@"Location: %@", location);

float zoomLevel = locationManager.accuracyAuthorization == CLAccuracyAuthorizationFullAccuracy ? preciseLocationZoomLevel : approximateLocationZoomLevel;
GMSCameraPosition * camera = [GMSCameraPosition cameraWithLatitude:location.coordinate.latitude
longitude:location.coordinate.longitude
mapView.camera = camera;
CLAccuracyAuthorization accuracy = manager.accuracyAuthorization;
switch (accuracy) {
case CLAccuracyAuthorizationFullAccuracy:
NSLog(@"Location accuracy is precise.");
break;
case CLAccuracyAuthorizationReducedAccuracy:
NSLog(@"Location accuracy is not precise.");
break;
NSLog(@"Location access was restricted.");
break;
case kCLAuthorizationStatusDenied:
NSLog(@"User denied access to location.");
case kCLAuthorizationStatusNotDetermined:
NSLog(@"Location status not determined.");
case kCLAuthorizationStatusAuthorizedAlways:
case kCLAuthorizationStatusAuthorizedWhenInUse:
NSLog(@"Location status is OK.");
NSLog(@"Error: %@", error.localizedDescription);
PlacesViewController

Swift
import UIKit
import GooglePlaces

class PlacesViewController: UIViewController {

performSegue(withIdentifier: "unwindToMain", sender: self)

return cell
Objective-C
#import "PlacesViewController.h"

@interface PlacesViewController () <UITableViewDataSource, UITableViewDelegate>
[self performSegueWithIdentifier:@"unwindToMain" sender:self];
Swift Package Manager
iOS용 Maps SDK는 Swift 패키지 관리자 [https://developer.apple.com/documentation/xcode/swift-packages]를 사용하여 설치할 수 있습니다.

기존 iOS용 Maps SDK 종속 항목을 삭제합니다.
터미널 창을 열고 tutorials/current-place-on-map 디렉터리로 이동합니다.

Xcode 작업공간을 닫고 다음 명령어를 실행합니다.
sudo gem install cocoapods-deintegrate cocoapods-clean
pod deintegrate
pod cache clean --all
rm Podfile
rm current-place-on-map.xcworkspace

Xcode 프로젝트를 열고 podfile을 삭제합니다.
Places 및 Maps SDK를 추가합니다.

File(파일) > Add Package Dependencies(패키지 종속 항목 추가)로 이동합니다.

https://github.com/googlemaps/ios-places-sdk [https://github.com/googlemaps/ios-places-sdk]를 URL로 입력하고 Enter 키를 눌러 패키지를 가져온 다음 패키지 추가를 클릭합니다.
https://github.com/googlemaps/ios-maps-sdk [https://github.com/googlemaps/ios-maps-sdk]를 URL로 입력하고 Enter 키를 눌러 패키지를 가져온 다음 패키지 추가를 클릭합니다.

파일 > 패키지 > 패키지 캐시 재설정을 사용하여 패키지 캐시를 재설정해야 할 수도 있습니다.

CocoaPods 사용

Xcode [https://developer.apple.com/xcode/]
버전 16.0 이상을 다운로드하여 설치합니다.
CocoaPods [https://guides.cocoapods.org/using/getting-started.html]가 아직 없으면 터미널에서 다음 명령어를 실행하여 macOS에 설치합니다.
sudo gem install cocoapods
tutorials/current-place-on-map 디렉터리로 이동합니다.
pod install 명령어를 실행합니다. Podfile에 지정된 지도 및 Places SDK [https://developers.google.com/maps/documentation/ios-sdk?hl=ko]가 종속 항목과 함께 설치됩니다.
pod outdated를 실행하여 설치된 포드 버전을 새 업데이트와 비교합니다. 새 버전이 감지되면 pod update를 실행하여 Podfile를 업데이트하고 최신 SDK를 설치합니다. 자세한 내용은 CocoaPods 가이드 [https://guides.cocoapods.org/using/pod-install-vs-update.html]를 참고하세요.
프로젝트의 current-place-on-map.xcworkspace 파일을 열어 (더블클릭) Xcode에서 엽니다. .xcworkspace 파일을 사용하여 프로젝트를 열어야 합니다.

API 키 가져오기 및 필요한 API 사용 설정하기

이 튜토리얼을 완료하려면 iOS용 Maps SDK 및 Places API를 사용할 수 있도록 승인된 Google API 키가 필요합니다.

Google Maps Platform 시작하기 [https://developers.google.com/maps/get-started?hl=ko]의 안내에 따라 결제 계정 및 두 제품이 모두 사용 설정된 프로젝트를 설정합니다.
API 키 가져오기 [https://developers.google.com/maps/documentation/ios-sdk/get-api-key?hl=ko#get_key]의 안내에 따라 이전에 설정한 개발 프로젝트 [https://developers.google.com/maps/documentation/ios-sdk/current-place-tutorial?hl=ko#set-up-your-development-project]의 API 키를 만듭니다.

애플리케이션에 API 키 추가

다음과 같이 API 키를 AppDelegate.swift에 추가합니다.

다음 가져오기 문이 파일에 추가되었는지 확인합니다.
import GooglePlaces
import GoogleMaps

application(_:didFinishLaunchingWithOptions:) 메서드에서 다음 줄을 편집하여 YOUR_API_KEY를 본인의 API 키로 대체합니다.
GMSPlacesClient.provideAPIKey("YOUR_API_KEY")
GMSServices.provideAPIKey("YOUR_API_KEY")

참고: 구성 [https://developers.google.com/maps/documentation/ios-sdk/get-api-key?hl=ko#get_key]에 따라 Maps SDK API 키가 Places SDK API 키와 동일한 값일 수 있습니다.

앱 빌드 및 실행

iOS 기기를 컴퓨터에 연결하거나 Xcode 스키마 메뉴에서 시뮬레이터 [https://developer.apple.com/library/content/documentation/IDEs/Conceptual/iOS_Simulator_Guide/Introduction/Introduction.html]를 선택합니다.
기기를 사용하는 경우 위치 서비스가 사용 설정되어 있는지 확인합니다.
시뮬레이터를 사용하는 경우 기능 메뉴에서 위치를 선택합니다.
Xcode에서 Product/Run 메뉴 옵션 (또는 재생 버튼 아이콘)을 클릭합니다.

Xcode에서 앱을 빌드한 다음 기기 또는 시뮬레이터에서 앱을 실행합니다.
현재 위치를 중심으로 여러 개의 마커가 있는 지도가 표시됩니다.

문제 해결:

지도가 표시되지 않으면 위에서 설명한 대로 [https://developers.google.com/maps/documentation/ios-sdk/current-place-tutorial?hl=ko#add_api_key] API 키를 가져와 앱에 추가했는지 확인하세요. Xcode의 디버깅 콘솔에서 API 키에 관한 오류 메시지를 확인합니다.
iOS 번들 식별자로 API 키를 제한한 경우 키를 수정하여 앱에 대한 번들 식별자를 추가하세요(com.google.examples.current-place-on-map).
위치 서비스 권한 요청이 거부되면 지도가 제대로 표시되지 않습니다.

기기를 사용하는 경우 설정/일반/개인 정보 보호/위치 서비스로 이동하여 위치 서비스를 다시 사용 설정합니다.
시뮬레이터를 사용하는 경우 Simulator/Reset Content and
Settings...로 이동합니다.

다음에 앱을 실행할 때 위치 서비스 프롬프트를 수락해야 합니다.

Wi-Fi 또는 GPS 연결 상태가 양호해야 합니다.
앱이 실행되지만 지도가 표시되지 않으면 프로젝트의 Info.plist를 적절한 위치 권한으로 업데이트했는지 확인하세요. 권한 처리에 관한 자세한 내용은 아래의 앱에서 위치 정보 액세스 권한 요청 [https://developers.google.com/maps/documentation/ios-sdk/current-place-tutorial?hl=ko#request_location_permission] 가이드를 참고하세요.
Xcode 디버깅 도구 [https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/debugging_with_xcode/chapters/debugging_tools.html]를 사용하여 로그를 확인하고 앱을 디버그합니다.

코드 이해하기

여기에서는 유사한 앱을 빌드하는 방법을 이해할 수 있도록
current-place-on-map 앱의 가장 중요한 부분을 설명합니다.

current-place-on-map 앱에는 두 개의 뷰 컨트롤러가 있습니다. 하나는 사용자가 선택한 장소를 보여주는 지도를 표시하고 다른 하나는 사용자가 선택할 수 있는 예상 장소 목록을 표시합니다. 각 뷰 컨트롤러에는 예상 장소 목록 (likelyPlaces)을 추적하고 사용자의 선택 (selectedPlace)을 나타내는 동일한 변수가 있습니다. 뷰 간 탐색은 세그웨이 [https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/UsingSegues.html]를 사용하여 이루어집니다.

위치 정보 액세스 권한 요청

앱은 사용자에게 위치 서비스 사용에 대한 동의를 요청해야 합니다. 이렇게 하려면 앱의 Info.plist 파일에 NSLocationAlwaysUsageDescription 키를 포함하고 각 키의 값을 앱이 위치 데이터를 사용하는 방법을 설명하는 문자열로 설정합니다.

위치 관리자 설정

참고: iOS 14에는 사용자가 정확한 위치 대신 대략적인 위치를 공유하도록 선택할 수 있는 새로운 개인 정보 보호 기능이 도입되었습니다. 앱이 적절하게 동작하도록 CLLocationManager에서 앱의 accuracyAuthorization [https://developer.apple.com/documentation/corelocation/cllocationmanager/3600215-accuracyauthorization] 값을 확인합니다.
자세한 내용은 이 동영상을 참고하세요. [https://developer.apple.com/videos/play/wwdc2020/10162/]

CLLocationManager [https://developer.apple.com/reference/corelocation/cllocationmanager]를 사용하여 기기의 현재 위치를 찾고 기기가 새 위치로 이동할 때 정기 업데이트를 요청합니다. 이 튜토리얼에서는 기기의 위치를 가져오는 데 필요한 코드를 제공합니다. 자세한 내용은 Apple 개발자 문서의 사용자 위치 가져오기 [https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/LocationAwarenessPG/CoreLocation/CoreLocation.html#//apple_ref/doc/uid/TP40009497-CH2-SW1] 가이드를 참고하세요.

클래스 수준에서 위치 관리자, 현재 위치, 지도 뷰, 장소 클라이언트, 기본 확대/축소 수준을 선언합니다.

Swift
Objective-C
CLLocationManager *locationManager;
CLLocation * _Nullable currentLocation;
GMSMapView *mapView;
GMSPlacesClient *placesClient;
float preciseLocationZoomLevel;
float approximateLocationZoomLevel;

viewDidLoad()에서 위치 관리자와 GMSPlacesClient를 초기화합니다.

Swift
locationManager.desiredAccuracy = kCLLocationAccuracyBest
locationManager.requestWhenInUseAuthorization()
locationManager.distanceFilter = 50
locationManager.startUpdatingLocation()
locationManager.delegate = self

placesClient = GMSPlacesClient.shared()

Objective-C
locationManager.desiredAccuracy = kCLLocationAccuracyBest;
[locationManager requestWhenInUseAuthorization];
locationManager.distanceFilter = 50;
[locationManager startUpdatingLocation];
locationManager.delegate = self;

placesClient = [GMSPlacesClient sharedClient];

예상 장소 목록과 사용자가 선택한 장소를 저장할 변수를 선언합니다.

Swift
Objective-C
NSMutableArray<GMSPlace *> *likelyPlaces;

GMSPlace * _Nullable selectedPlace;

확장 프로그램 절을 사용하여 위치 관리자의 이벤트를 처리하는 대리자를 추가합니다.

Swift
mapView.camera = camera
case .reducedAccuracy:
print("Location accuracy is not precise.")
@unknown default:
fatalError()
case .denied:
print("User denied access to location.")
case .notDetermined:
print("Location status not determined.")
case .authorizedAlways: fallthrough
case .authorizedWhenInUse:
print("Location status is OK.")
@unknown default:
fatalError()
print("Error: \(error)")
Objective-C
CLLocation *location = locations.lastObject;
NSLog(@"Location: %@", location);

float zoomLevel = locationManager.accuracyAuthorization == CLAccuracyAuthorizationFullAccuracy ? preciseLocationZoomLevel : approximateLocationZoomLevel;
GMSCameraPosition * camera = [GMSCameraPosition cameraWithLatitude:location.coordinate.latitude
longitude:location.coordinate.longitude
mapView.camera = camera;
CLAccuracyAuthorization accuracy = manager.accuracyAuthorization;
switch (accuracy) {
case CLAccuracyAuthorizationFullAccuracy:
NSLog(@"Location accuracy is precise.");
break;
case CLAccuracyAuthorizationReducedAccuracy:
NSLog(@"Location accuracy is not precise.");
break;
NSLog(@"Location access was restricted.");
break;
case kCLAuthorizationStatusDenied:
NSLog(@"User denied access to location.");
case kCLAuthorizationStatusNotDetermined:
NSLog(@"Location status not determined.");
case kCLAuthorizationStatusAuthorizedAlways:
case kCLAuthorizationStatusAuthorizedWhenInUse:
NSLog(@"Location status is OK.");
NSLog(@"Error: %@", error.localizedDescription);
mapView.autoresizingMask = [.flexibleWidth, .flexibleHeight]
mapView.isMyLocationEnabled = true

mapView.isHidden = true

Objective-C
CLLocationCoordinate2D defaultLocation = CLLocationCoordinate2DMake(-33.869405, 151.199);

GMSCameraPosition *camera = [GMSCameraPosition cameraWithLatitude:defaultLocation.latitude
longitude:defaultLocation.longitude
mapView.settings.myLocationButton = YES;
mapView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
mapView.myLocationEnabled = YES;

mapView.hidden = YES;

사용자에게 현재 장소를 선택하라는 메시지 표시

iOS용 Places SDK를 사용하여 사용자의 현재 위치를 기반으로 상위 5개 장소 가능성을 가져오고 UITableView에 목록을 표시합니다. 사용자가 장소를 선택하면 지도에 마커를 추가합니다.

사용자가 있는 장소를 선택할 수 있는 UITableView를 채우기 위해 예상 장소 목록을 가져옵니다.

Swift

return
Objective-C

GMSPlaceField placeFields = GMSPlaceFieldName | GMSPlaceFieldCoordinate;
[placesClient findPlaceLikelihoodsFromCurrentLocationWithPlaceFields:placeFields callback:^(NSArray<GMSPlaceLikelihood *> * _Nullable likelihoods, NSError * _Nullable error) {
if (error != nil) {
NSLog(@"Current Place error: %@", error.localizedDescription);
return;
NSLog(@"No places found.");
return;
GMSPlace *place = likelihood.place;
[likelyPlaces addObject:place];
Objective-C
PlacesViewController *placesViewController = (PlacesViewController *)segue.destinationViewController;
placesViewController.likelyPlaces = likelyPlaces;
PlacesViewController에서 UITableViewDataSource 위임 확장 프로그램을 사용하여 가장 가능성이 높은 장소 목록을 사용하여 표를 채웁니다.

Swift

return cell
Objective-C
#pragma mark - UITableViewDataSource

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
return self.likelyPlaces.count;
UITableViewDelegate 위임 확장 프로그램을 사용하여 사용자의 선택을 처리합니다.

Swift
class PlacesViewController: UIViewController {

performSegue(withIdentifier: "unwindToMain", sender: self)
Objective-C
@interface PlacesViewController () <UITableViewDataSource, UITableViewDelegate>
[self performSegueWithIdentifier:@"unwindToMain" sender:self];
IBAction은 기본 보기 컨트롤러로 돌아갈 때 자동으로 호출됩니다.

Swift

marker.snippet = selectedPlace?.formattedAddress
marker.map = mapView
Objective-C

GMSMarker *marker = [GMSMarker markerWithPosition:selectedPlace.coordinate];
marker.title = selectedPlace.name;
marker.snippet = selectedPlace.formattedAddress;
marker.map = mapView;