Source URL: https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko
Title: 데이터베이스 측정항목 모니터링
bookmark_border

이제 MongoDB 호환성을 갖춘 Cloud Firestore Enterprise 버전을 사용할 수 있습니다. 자세히 알아보기 [https://firebase.google.com/docs/firestore/enterprise/mongodb-compatibility-overview?hl=ko]

의견 보내기

데이터베이스 측정항목 모니터링

bookmark_borderbookmark

컬렉션을 사용해 정리하기

내 환경설정을 기준으로 콘텐츠를 저장하고 분류하세요.

이 페이지의 내용MongoDB 호환성을 갖춘 Cloud Firestore의 Cloud Monitoring 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#monitoring-metrics]모니터링 리소스 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#monitored-resources]측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#metrics]서비스 런타임 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#service_runtime_metrics]문서 작업 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#document_operation_metrics]결제 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#billing_metrics]색인 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#index_metrics]TTL 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#ttl_metrics]사전 정의된 대시보드 보기 및 커스텀 대시보드 만들기 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#view_predefined_dashboards_and_create_custom_dashboards]데이터베이스 사용량 측정항목 보기 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#view_database_usage_metrics]데이터베이스 성능 측정항목 보기 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#view_database_performance_metrics]커스텀 Cloud Monitoring 대시보드 만들기 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#create-dashboard]알림 정책 만들기 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#create_an_alerting_policy]

| Cloud Firestore Enterprise 버전에만 해당합니다. |
| --- |

이 페이지에서는 MongoDB 호환성을 갖춘 Cloud Firestore의 Cloud Monitoring 측정항목을 사용하여 데이터베이스를 모니터링하는 방법을 설명합니다.

MongoDB 호환성을 갖춘 Cloud Firestore의 Cloud Monitoring 측정항목

다음 섹션에서는 MongoDB 호환성을 갖춘 Cloud Firestore에서 사용할 수 있는 측정항목을 간략하게 설명합니다.

모니터링 리소스

Cloud Monitoring의 모니터링 리소스는 가상 머신, 데이터베이스, 애플리케이션과 같은 논리적 또는 실제 항목을 나타냅니다. 모니터링 리소스에는 탐색하거나, 대시보드를 통해 보고하거나, 알림을 만드는 데 사용할 수 있는 고유한 측정항목 집합이 포함되어 있습니다. 각 리소스에는 리소스에 관한 추가 정보를 보유하는 키-값 쌍인 리소스 라벨 집합도 있습니다. 리소스 라벨은 리소스와 연결된 모든 측정항목에 사용할 수 있습니다.

Cloud Monitoring API [https://cloud.google.com/monitoring/api/resources?hl=ko]를 사용하여 MongoDB 호환성을 갖춘 Cloud Firestore 성능은 다음 리소스로 모니터링됩니다.

| 리소스 | 설명 |
| --- | --- |
| firestore.googleapis.com/Database | project, location, database_id에 대한 분석을 제공하는 모니터링 리소스 유형입니다. |

측정항목

Cloud Firestore 측정항목의 전체 목록은 Cloud Firestore 측정항목 [https://cloud.google.com/monitoring/api/metrics_gcp_d_h?hl=ko#gcp-firestore]을 참고하세요.
다음 섹션에서는 사용 가능한 측정항목을 설명합니다.

서비스 런타임 측정항목

serviceruntime [https://cloud.google.com/monitoring/api/metrics_gcp_p_z?hl=ko#gcp-serviceruntime] 측정항목은 프로젝트 트래픽에 대한 개략적인 개요를 제공합니다. 이러한 측정항목은 대부분의 Google Cloud API에서 사용할 수 있습니다. consumed_api [https://cloud.google.com/monitoring/api/resources?hl=ko#tag_consumed_api] 모니터링 리소스 유형에는 이러한 일반 측정항목이 포함됩니다. 이러한 측정항목은 30분마다 샘플링되므로 데이터가 평활화됩니다.

serviceruntime 측정항목의 중요한 리소스 라벨은 method입니다. 이 라벨은 호출된 기본 RPC 메서드를 나타냅니다. 호출하는 SDK 메서드의 이름은 기본 RPC 메서드와 동일하지 않을 수 있습니다. SDK는 상위 수준 API 추상화를 제공하기 때문입니다. 하지만 애플리케이션이 Cloud Firestore와 상호작용하는 방식을 이해하려면 RPC 메서드 이름을 기반으로 한 측정항목을 이해하는 것이 중요합니다.

특정 SDK 메서드의 기본 RPC 메서드를 알아야 하는 경우 API 참고 리소스 [https://cloud.google.com/firestore/docs/reference/rpc/google.firestore.v1?hl=ko]를 참고하세요.

api/request_latencies

api/request_latencies 측정항목은 완료된 모든 요청의 지연 시간 분포를 제공합니다.

Cloud Firestore는 Cloud Firestore 서비스 구성요소의 측정항목을 기록합니다. 지연 시간 측정항목에는 Cloud Firestore가 요청을 받는 시점부터 스토리지 레이어와의 상호작용을 포함하여 Cloud Firestore가 응답 전송을 완료하는 시점까지의 시간이 포함됩니다. 따라서 클라이언트와 Cloud Firestore 서비스 간의 왕복 지연 시간(rtt)은 이러한 측정항목에 포함되지 않습니다.

문서 작업 측정항목

Cloud Firestore는 읽기, 쓰기, 삭제 수를 제공합니다. 쓰기 측정항목은 'CREATE' 작업과 'UPDATE' 작업 간의 분류를 제공합니다. 이러한 측정항목은 CRUD 작업과 일치합니다.

다음 측정항목을 사용하여 데이터베이스가 읽기 또는 쓰기 집약적인지와 새 문서 대비 삭제된 문서의 비율을 파악할 수 있습니다.

document/delete_ops_count: 성공적인 문서 삭제 횟수입니다.
document/read_ops_count: 쿼리 또는 조회를 통해 성공한 문서 읽기 횟수입니다.
document/write_ops_count: 성공적인 문서 쓰기 횟수입니다.

참고: document/delete_ops_count 측정항목에는 TTL 정책으로 인해 삭제된 문서가 포함되지 않습니다. TTL 정책으로 인해 삭제를 캡처하는 측정항목에 대한 자세한 내용은 TTL 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#ttl_metrics]을 참조하세요.
결제 측정항목

이러한 측정항목을 사용하여 청구 사용량을 파악하세요. 이러한 측정항목에는 관리자 작업(색인 생성, 가져오기, 내보내기, 일괄 삭제)의 청구가 포함되지 않습니다.

api/billable_read_units: 청구 가능한 읽기 단위 수입니다.
사용량은 서비스 이름과 API 메서드로 분류할 수 있습니다.
api/billable_write_units: 청구 가능한 쓰기 단위 수입니다.
사용량은 서비스 이름과 API 메서드로 분류할 수 있습니다.
document/billable_managed_delete_write_units: TTL [https://firebase.google.com/docs/firestore/enterprise/ttl?hl=ko]과 같은 관리형 삭제 서비스에서 청구 가능한 쓰기 단위 수입니다.

색인 측정항목

색인 팬아웃을 이해하기 위해 색인 쓰기 속도를 document/write_ops_count 측정항목과 대조할 수 있습니다.

index/write_count: 색인 쓰기 횟수입니다.

TTL 측정항목

MongoDB 호환성을 갖춘 Cloud Firestore의 TTL 측정항목은 적용된 TTL 정책 [https://firebase.google.com/docs/firestore/enterprise/ttl?hl=ko]의 효과를 모니터링하는 데 사용됩니다.

document/ttl_deletion_count: TTL 서비스에 의해 삭제된 총 문서 수입니다.
document/ttl_expiration_to_deletion_delays: TTL이 있는 문서가 만료된 시점과 실제로 삭제된 시점 사이에 경과한 시간입니다.

사전 정의된 대시보드 보기 및 커스텀 대시보드 만들기

MongoDB 호환성을 갖춘 Cloud Firestore는 Cloud Monitoring 측정항목을 사용하는 사전 정의된 대시보드를 지원합니다.
또한 커스텀 대시보드도 만들 수 있습니다.

데이터베이스 사용량 측정항목 보기

Google Cloud 콘솔에서 사용량 대시보드를 열어 시간 경과에 따른 문서 읽기, 쓰기, 삭제를 확인합니다.

액세스 제어

사용량 대시보드에는 monitoring.timeSeries.list Identity and Access Management(IAM) 권한이 필요합니다.
프로젝트 소유자, 편집자, 뷰어 역할이 이 권한을 부여합니다. Cloud Monitoring 역할 [https://cloud.google.com/monitoring/access-control?hl=ko#monitoring_2]을 또는 커스텀 역할 [https://cloud.google.com/iam/docs/creating-custom-roles?hl=ko]을 통해 이 권한을 부여할 수도 있습니다.

데이터베이스 사용량 대시보드

MongoDB 호환성을 갖춘 Cloud Firestore 데이터베이스의 사용량 측정항목을 보려면 다음 단계를 따르세요.

Google Cloud 콘솔에서 데이터베이스 페이지로 이동합니다.

데이터베이스로 이동 [https://console.cloud.google.com/firestore/databases?hl=ko]
데이터베이스 목록에서 필요한 데이터베이스를 선택합니다.
탐색 메뉴에서 사용량을 클릭합니다.

사용량 대시보드 및 결제 보고서

콘솔의 Cloud Firestore 사용량 대시보드는 예상 사용량을 제공합니다. 대시보드를 통해 사용량 급증을 파악할 수 있습니다.
하지만 대시보드에 표시된 청구 대상 작업이 정확하지 않을 수 있으며 청구 사용량이 더 높을 수 있습니다. 결제를 모니터링하려면 결제 측정항목 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#billing_metrics]을 참고하세요.

불일치가 발생하는 경우 언제나 결제 보고서가 사용량 대시보드보다 우선합니다.

가져오기 및 내보내기 작업으로 인해 사용량 대시보드와 청구 사용량 간에 불일치가 발생합니다. 이러한 작업으로 수행되는 읽기 및 쓰기는 사용량 대시보드에 표시되지 않습니다.

데이터베이스 성능 측정항목 보기

Google Cloud 콘솔의 Cloud Firestore 섹션에 있는 Monitoring 페이지에는 요청 지연 시간(P50 및 P99), 응답 코드, 쿼리 통계(P50)와 같은 사전 정의된 모니터링 대시보드가 포함되어 있습니다.
커스텀 대시보드는 최대 1개까지 만들 수 있습니다. 데이터베이스의 Monitoring 페이지에 액세스하려면 다음 단계를 따르세요.

Google Cloud 콘솔에서 Cloud Firestore 데이터베이스 페이지를 엽니다.

데이터베이스로 이동 [https://console.cloud.google.com/firestore/databases?hl=ko]

목록에서 데이터베이스를 선택합니다.
탐색 메뉴에서 Monitoring을 클릭하여 대시보드를 엽니다.

커스텀 Cloud Monitoring 대시보드 만들기

Cloud Monitoring에서 커스텀 대시보드를 사용하면 관련 정보를 체계적인 방식으로 표시할 수 있습니다. 예를 들어 프로덕션 환경에서 프로젝트의 성능 측정항목 및 알림 정책을 표시하도록 대시보드를 만들 수 있습니다.

커스텀 대시보드 설정에 대한 자세한 내용은 커스텀 대시보드 관리 [https://cloud.google.com/monitoring/charts/dashboards?hl=ko] 및 대시보드 위젯 추가 [https://cloud.google.com/monitoring/charts?hl=ko]를 참조하세요.

알림 정책 만들기

Cloud Monitoring에서는 측정항목 조건이 변경될 때 이를 알려주는 알림 [https://cloud.google.com/monitoring/alerts?hl=ko]을 만들 수 있습니다. 이러한 알림을 사용해서 잠재적인 문제가 사용자에게 영향을 주기 전에 알림을 받을 수 있습니다.

알림 만들기에 대한 자세한 내용은 측정항목 기준 알림 정책 만들기 [https://cloud.google.com/monitoring/alerts/using-alerting-ui?hl=ko]을 참조하세요.

다음 예시에서는 지연 시간 알림 정책을 만듭니다. 알림 정책은 순환 기간 5분 동안 p99 지연 시간을 확인합니다. p99 지연 시간이 5분 동안 250밀리초보다 높게 유지되면 알림이 트리거됩니다.

--- 탭: 콘솔 [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 Monitoring 페이지로 이동하여 notifications 알림을 선택합니다.
Monitoring으로 이동 [https://console.cloud.google.com/monitoring/alerting?hl=ko]
정책 만들기를 선택합니다.
사용된 API 리소스에서 요청 지연 시간 측정항목을 선택합니다.
Cloud Firestore 표준 데이터베이스의 firestore.googleapis.com 서비스 필터를 추가합니다.
다음을 클릭하여 트리거를 구성합니다.
조건 유형을 기준점으로 선택합니다.
기준점 조건이 기준점 250밀리초로 설정됩니다. p99 지연 시간 값이 순환 기간(5분) 동안 동일하게 유지되면 알림이 트리거됩니다.
기준점을 250으로 설정합니다.
다음을 클릭하여 알림을 구성합니다.
알림 정책 이름을 설정하고 다음을 클릭합니다.
알림 구성을 검토한 후 정책 만들기를 클릭합니다.

--- 탭: MQL [https://firebase.google.com/docs/firestore/enterprise/use-monitoring-dashboard?hl=ko#mql] ---
```
fetch consumed_api
| metric 'serviceruntime.googleapis.com/api/request_latencies'
| filter (resource.service == 'firestore.googleapis.com')
| group_by 5m,
[value_request_latencies_percentile:
percentile(value.request_latencies, 99)]
| every 5m
| condition val() > 0.25 's'
```

의견 보내기