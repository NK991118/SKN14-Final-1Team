Source URL: https://cloud.google.com/bigquery/docs/transfer-custom-constraints

BigQuery [https://cloud.google.com/bigquery?hl=ko]
Documentation [https://cloud.google.com/bigquery/docs?hl=ko]
가이드 [https://cloud.google.com/bigquery/docs/introduction?hl=ko]
도움이 되었나요?
의견 보내기
이 페이지의 내용
조직 정책 및 제약조건 정보 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#about_organization_policies_and_constraints]
정책 상속 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#policy-inheritance]
이점 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#benefits]
제한사항 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#limitations]
시작하기 전에 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#before-you-begin]
커스텀 조직 정책 사용
bookmark_border
이 페이지에서는 조직 정책 서비스 커스텀 제약조건을 사용하여 다음 Google Cloud 리소스에 대한 특정 작업을 제한하는 방법을 보여줍니다.
bigquerydatatransfer.googleapis.com/TransferConfig
조직 정책에 대한 자세한 내용은 커스텀 조직 정책 [https://cloud.google.com/resource-manager/docs/organization-policy/overview?hl=ko#custom-organization-policies]을 참조하세요.
조직 정책 및 제약조건 정보
Google Cloud 조직 정책 서비스를 사용하면 조직 리소스를 중앙에서 프로그래매틱 방식으로 제어할 수 있습니다. 조직 정책 관리자 [https://cloud.google.com/iam/docs/understanding-roles?hl=ko#orgpolicy.policyAdmin]는 Google Cloud 리소스 계층 구조 [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy?hl=ko]에서Google Cloud 리소스 및 이러한 리소스의 하위 요소에 적용되는 제약조건이라는 제한사항 집합인 조직 정책을 정의할 수 있습니다. 조직, 폴더 또는 프로젝트 수준에서 조직 정책을 적용할 수 있습니다.
조직 정책은 다양한 Google Cloud 서비스에 내장된 관리형 제약조건 [https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=ko]을 제공합니다. 그러나 조직 정책에서 제한되는 특정 필드를 보다 세부적으로 맞춤설정 가능한 방식으로 제어하려면 커스텀 제약조건을 만들고 조직 정책에 이러한 커스텀 제약조건을 사용할 수 있습니다.
정책 상속
기본적으로 조직 정책은 정책을 적용하는 리소스의 하위 요소에 상속됩니다. 예를 들어 폴더에 정책을 적용하면 Google Cloud 가 폴더의 모든 프로젝트에 정책을 적용합니다. 이 동작 및 이를 변경하는 방법에 대한 자세한 내용은 계층 구조 평가 규칙 [https://cloud.google.com/resource-manager/docs/organization-policy/understanding-hierarchy?hl=ko#disallow_inheritance]을 참조하세요.
이점
커스텀 조직 정책을 사용하여 조직의 규정 준수 및 보안 요구사항을 충족하기 위해 BigQuery Data Transfer Service 전송 구성에 대한 특정 작업을 허용하거나 거부할 수 있습니다. 전송 구성을 만들거나 업데이트하는 요청이 조직 정책에 설정된 커스텀 제약 조건을 충족하지 못하면 요청이 실패하고 호출자에게 오류가 반환됩니다.
제한사항
커스텀 제약 조건에서 데이터 소스를 지정하려면 데이터 소스 값과 함께 resource.dataSourceId 필드를 사용하세요. resource.dataSourceId에 지원되는 값 목록을 보려면 dataSources.list 메서드 [https://cloud.google.com/bigquery/docs/reference/datatransfer/rest/v1/projects.dataSources/list?hl=ko]를 호출하세요.
시작하기 전에
Sign in to your Google Cloud account. If you're new to Google Cloud, create an account [https://console.cloud.google.com/freetrial?hl=ko] to evaluate how our products perform in real-world scenarios. New customers also get $300 in free credits to run, test, and deploy workloads.
In the Google Cloud console, on the project selector page, select or create a Google Cloud project.
Note: If you don't plan to keep the resources that you create in this procedure, create a project instead of selecting an existing project. After you finish these steps, you can delete the project, removing all resources associated with the project.
Go to project selector [https://console.cloud.google.com/projectselector2/home/dashboard?hl=ko]
Verify that billing is enabled for your Google Cloud project [https://cloud.google.com/billing/docs/how-to/verify-billing-enabled?hl=ko#confirm_billing_is_enabled_on_a_project].
Install [https://cloud.google.com/sdk/docs/install?hl=ko] the Google Cloud CLI.
외부 ID 공급업체(IdP)를 사용하는 경우 먼저 제휴 ID로 gcloud CLI에 로그인 [https://cloud.google.com/iam/docs/workforce-log-in-gcloud?hl=ko]해야 합니다.
gcloud CLI를 초기화하려면 [https://cloud.google.com/sdk/docs/initializing?hl=ko], 다음 명령어를 실행합니다.
gcloud init
조직 ID [https://cloud.google.com/resource-manager/docs/creating-managing-organization?hl=ko#retrieving_your_organization_id]를 알고 있어야 합니다.
필요한 역할
조직 정책을 관리하는 데 필요한 권한을 얻으려면 관리자에게 다음의 IAM 역할을 부여해 달라고 요청합니다.
조직 리소스의 조직 정책 관리자 [https://cloud.google.com/iam/docs/roles-permissions/orgpolicy?hl=ko#orgpolicy.policyAdmin](roles/orgpolicy.policyAdmin)
BigQuery Data Transfer Service 전송 구성 생성 또는 업데이트: 프로젝트 리소스의 BigQuery 관리자 [https://cloud.google.com/iam/docs/roles-permissions/bigquery?hl=ko#bigquery.admin](roles/bigquery.admin)
역할 부여에 대한 자세한 내용은 프로젝트, 폴더, 조직에 대한 액세스 관리 [https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=ko]를 참조하세요.
이러한 사전 정의된 역할에는 조직 정책 관리에 필요한 권한이 포함되어 있습니다. 필요한 정확한 권한을 보려면 필수 권한 섹션을 펼치세요.
필수 권한
커스텀 역할 [https://cloud.google.com/iam/docs/creating-custom-roles?hl=ko]이나 다른 사전 정의된 역할 [https://cloud.google.com/iam/docs/roles-overview?hl=ko#predefined]을 사용하여 이 권한을 부여받을 수도 있습니다.
커스텀 제약조건 만들기
커스텀 제약조건은 조직 정책을 적용하는 서비스에서 지원되는 리소스, 메서드, 조건, 작업을 사용하여 YAML 파일에서 정의됩니다. 커스텀 제약조건의 조건은 Common Expression Language(CEL) [https://github.com/google/cel-spec/blob/master/doc/intro.md]를 사용하여 정의됩니다. CEL을 사용해서 커스텀 제약조건에서 조건을 빌드하는 방법은 커스텀 제약조건 만들기 및 관리 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=ko#common_expression_language]의 CEL 섹션을 참조하세요.
커스텀 제약조건을 만들려면 다음 형식을 사용하여 YAML 파일을 만듭니다.
name: organizations/
ORGANIZATION_ID/customConstraints/
CONSTRAINT_NAME
resourceTypes:
- 
RESOURCE_NAME
methodTypes:
- CREATE
- UPDATE
condition: "
CONDITION"
actionType: 
ACTION
displayName: 
DISPLAY_NAME
description: 
DESCRIPTION
다음을 바꿉니다.
ORGANIZATION_ID: 조직 ID(예: 123456789)
CONSTRAINT_NAME: 새 커스텀 제약조건에 사용하려는 이름. 커스텀 제약조건은 custom.으로 시작해야 하며 대문자, 소문자 또는 숫자만 포함할 수 있습니다. 예를 들면 custom.dtsEnableEmailNotification입니다. 이 필드의 최대 길이는 70자입니다.
RESOURCE_NAME: 제한하려는 객체 및 필드가 포함된Google Cloud 리소스의 정규화된 이름. 예를 들면 bigquerydatatransfer.googleapis.com/TransferConfig입니다.
CONDITION: 지원되는 서비스 리소스의 표현에 대해 작성된 CEL 조건 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=ko#common_expression_language]. 이 필드의 최대 길이는 1000자(영문 기준)입니다. 조건을 작성하는 데 사용할 수 있는 리소스에 대한 자세한 내용은 지원되는 리소스 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#supported_resources]를 참조하세요. 예를 들면 resource.emailPreferences.enableFailureEmail == true입니다.
ACTION: condition이 충족될 때 수행할 작업. 가능한 값은 ALLOW 및 DENY입니다.
DISPLAY_NAME: 제약조건에 대한 사용자 친화적인 이름. 이 필드의 최대 길이는 200자(영문 기준)입니다.
DESCRIPTION: 정책을 위반할 때 오류 메시지로 표시할 제약조건에 대한 사용자 친화적인 설명. 이 필드의 최대 길이는 2,000자(영문 기준)입니다.
커스텀 제약조건을 만드는 방법에 대한 자세한 내용은 커스텀 제약조건 정의 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=ko#defining_custom_constraints]를 참조하세요.
커스텀 제약조건 설정
새 커스텀 제약조건의 YAML 파일을 만든 후에는 조직에서 조직 정책에 사용할 수 있도록 설정해야 합니다. 커스텀 제약조건을 설정하려면 gcloud org-policies set-custom-constraint 명령어를 사용합니다.
gcloud org-policies set-custom-constraint 
CONSTRAINT_PATH
CONSTRAINT_PATH를 커스텀 제약조건 파일의 전체 경로로 바꿉니다. 예를 들면 /home/user/customconstraint.yaml입니다. 완료되면 Google Cloud 조직 정책 목록에서 조직 정책으로 커스텀 제약조건을 사용할 수 있습니다. 커스텀 제약조건이 존재하는지 확인하려면 gcloud org-policies list-custom-constraints 명령어를 사용합니다.
gcloud org-policies list-custom-constraints --organization=
ORGANIZATION_ID
ORGANIZATION_ID를 조직 리소스 ID로 바꿉니다. 자세한 내용은 조직 정책 보기 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-policies?hl=ko#viewing_organization_policies]를 참조하세요.
커스텀 조직 정책 적용
제약조건을 참조하는 조직 정책을 만들고 해당 조직 정책을 Google Cloud 리소스에 적용하여 제약조건을 적용할 수 있습니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 조직 정책 페이지로 이동합니다.
        조직 정책으로 이동 [https://console.cloud.google.com/iam-admin/orgpolicies?hl=ko] 
      
      
        프로젝트 선택 도구에서 조직 정책을 설정할 프로젝트를 선택합니다.
      
      
        조직 정책 페이지의 목록에서 제약조건을 선택하여 해당 제약조건의 정책 세부정보 페이지를 봅니다.
      
      
        이 리소스의 조직 정책을 구성하려면 정책 관리를 클릭합니다.
      
      
        정책 수정 페이지에서 상위 정책 재정의를 선택합니다.
      
      
        규칙 추가를 클릭합니다.
      
      
        적용 섹션에서 이 조직 정책 적용을 사용 설정할지 여부를 선택합니다.
      
      
        (선택사항) 태그로 조직 정책을 조건부로 만들려면 조건 추가를 클릭합니다. 조건부 규칙을 조직 정책에 추가하면 비조건부 규칙을 최소 하나 이상 추가해야 합니다. 그렇지 않으면 정책을 저장할 수 없습니다. 자세한 내용은 태그를 사용하여 조직 정책 설정 [https://cloud.google.com/resource-manager/docs/organization-policy/tags-organization-policy?hl=ko]을 참조하세요.
      
      
        변경사항 테스트를 클릭하여 조직 정책의 효과를 시뮬레이션합니다. 기존 관리형 제약조건에는 정책 시뮬레이션을 사용할 수 없습니다. 자세한 내용은 정책 시뮬레이터로 조직 정책 변경사항 테스트 [https://cloud.google.com/policy-intelligence/docs/test-organization-policies?hl=ko]를 참조하세요.
      
      
        조직 정책을 완료하고 적용하려면 정책 설정을 클릭합니다. 정책이 적용되는 데 최대 15분이 소요됩니다.

--- 탭: gcloud [https://cloud.google.com/bigquery/docs/transfer-custom-constraints?hl=ko#gcloud] ---
불리언 규칙이 있는 조직 정책을 만들려면 제약조건을 참조하는 정책 YAML 파일을 만듭니다.
    
          name: projects/PROJECT_ID/policies/CONSTRAINT_NAME
      spec:
        rules:
        - enforce: true
    
    
      다음을 바꿉니다.
    
    
      
        PROJECT_ID: 제약조건을 적용할 프로젝트
      
      
        CONSTRAINT_NAME: 커스텀 제약조건에 대해 정의된 이름. 예를 들면 custom.dtsEnableEmailNotification입니다.
      
    
    
      제약조건이 포함된 조직 정책을 적용하려면 다음 명령어를 실행합니다.
    
        gcloud org-policies set-policy POLICY_PATH
    
    
      POLICY_PATH를 조직 정책 YAML 파일의 전체 경로로 바꿉니다. 정책이 적용되는 데 최대 15분이 소요됩니다.
커스텀 조직 정책 테스트
다음 예시에서는 특정 프로젝트의 모든 새 전송 구성에 이메일 알림을 사용 설정해야 하는 커스텀 제약조건 및 정책을 만듭니다.
시작하기 전에 다음 사항을 알아야 합니다.
조직 ID
프로젝트 ID
제약조건 만들기
다음 파일을 constraint-dts-enable-email.yaml로 저장합니다.
name: organizations/
ORGANIZATION_ID/customConstraints/custom.dtsEnableEmailNotification
resourceTypes:
- bigquerydatatransfer.googleapis.com/TransferConfig
methodTypes:
- CREATE
condition: resource.emailPreferences.enableFailureEmail == true
actionType: ALLOW
displayName: The BigQuery Data Transfer Service always enables email notications
description: The BigQuery Data Transfer Service always enables email notications on data transfer failures.
ORGANIZATION_ID를 조직 ID [https://cloud.google.com/resource-manager/docs/creating-managing-organization?hl=ko#retrieving_your_organization_id]로 바꿉니다.
새 전송 구성에 이메일 알림이 사용 설정되어 있는지 확인하는 제약조건을 정의합니다. 사용 설정되어 있지 않으면 작업이 거부됩니다.
제약조건을 적용합니다.
gcloud org-policies set-custom-constraint ~/constraint-dts-enable-email.yaml
제약조건이 있는지 확인합니다.
gcloud org-policies list-custom-constraints --organization=
ORGANIZATION_ID
출력은 다음과 비슷합니다.
CUSTOM_CONSTRAINT                  ACTION_TYPE  METHOD_TYPES   RESOURCE_TYPES                                      DISPLAY_NAME
custom.dtsEnableEmailNotification  ALLOW        CREATE         bigquerydatatransfer.googleapis.com/TransferConfig  The BigQuery Data Transfer Service always enables email notications
...
정책 만들기
다음 파일을 policy-dts-enable-email.yaml로 저장합니다.
name: projects/
PROJECT_ID/policies/custom.dtsEnableEmailNotification
spec:
  rules:
  - enforce: true
PROJECT_ID를 프로젝트 ID로 바꿉니다.
정책을 적용합니다.
gcloud org-policies set-policy ~/policy-dts-enable-email.yaml
정책이 있는지 확인합니다.
gcloud org-policies list --project=
PROJECT_ID
출력은 다음과 비슷합니다.
CONSTRAINT                         LIST_POLICY  BOOLEAN_POLICY        ETAG
custom.dtsEnableEmailNotification  -            SET                   CPyxlbgGENDL3tEC-
정책을 적용한 후 Google Cloud 가 정책 시행을 시작할 때까지 2분 정도 기다립니다.
정책 테스트
프로젝트에서 이메일 알림을 사용 중지한 BigQuery Data Transfer Service 전송 구성을 만들어 보세요.
출력은 다음과 같습니다.
Operation denied by custom org policy: ["customConstraints/custom.dtsEnableEmailNotification": "The BigQuery Data Transfer Service always enables email notications on data transfer failures."].
일반적인 사용 사례의 커스텀 조직 정책 예시
다음 표에는 일반적인 사용 사례에 대한 몇 가지 커스텀 제약조건의 구문이 나와 있습니다.
설명 제약조건 구문
Azure Blob Storage에서 데이터 전송 허용 안함
    name: organizations/
ORGANIZATION_ID/customConstraints/custom.denyDtsAzureTransfers
    resourceTypes:
    - bigquerydatatransfer.googleapis.com/TransferConfig
    methodTypes:
    - CREATE
    condition: resource.dataSourceId == "azure_blob_storage"
    actionType: DENY
    displayName: Deny data transfers from Azure Blob Storage to BigQuery
    description: Disallow creating data transfer configurations from Azure Blob Storage.
    
항상 자동 예약 사용 설정
    name: organizations/
ORGANIZATION_ID/customConstraints/custom.dtsNoManualSchedule
    resourceTypes:
    - bigquerydatatransfer.googleapis.com/TransferConfig
    methodTypes:
    - CREATE
    - UPDATE
    condition: resource.scheduleOptions.disableAutoScheduling == false
    actionType: ALLOW
    displayName: Transfer configurations always enable auto-scheduling
    description: Always enable auto-scheduling for BigQuery Data Transfer Service transfer configurations.
    
Google Ads 전송의 데이터 새로고침 기간은 3일 이상
    name: organizations/
ORGANIZATION_ID/customConstraints/custom.dtsGoogleAdsConstraint
    resourceTypes:
    - bigquerydatatransfer.googleapis.com/TransferConfig
    methodTypes:
    - CREATE
    - UPDATE
    condition: resource.dataSourceId == "google_ads" && resource.dataRefreshWindowDays < 3
    actionType: DENY
    displayName: Google Ads transfers data refresh window must be greater than three days
    description: Disallow creating Google Ads data transfer configurations whose data refresh window is less than three days.
    
BigQuery Data Transfer Service 지원 리소스
다음 표에는 커스텀 제약 조건에서 참조할 수 있는 BigQuery Data Transfer Service 리소스가 나와 있습니다.
리소스 필드
bigquerydatatransfer.googleapis.com/TransferConfig resource.dataRefreshWindowDays
resource.dataSourceId
resource.destinationDatasetId
resource.disabled
resource.displayName
resource.emailPreferences.enableFailureEmail
resource.encryptionConfiguration.kmsKeyName
resource.name
resource.notificationPubsubTopic
resource.schedule
resource.scheduleOptions.disableAutoScheduling
resource.scheduleOptions.endTime
resource.scheduleOptions.startTime
resource.scheduleOptionsV2.eventDrivenSchedule.pubsubSubscription
resource.scheduleOptionsV2.timeBasedSchedule.endTime
resource.scheduleOptionsV2.timeBasedSchedule.schedule
resource.scheduleOptionsV2.timeBasedSchedule.startTime
다음 단계
조직 정책 서비스 [https://cloud.google.com/resource-manager/docs/organization-policy/overview?hl=ko] 자세히 알아보기
조직 정책을 만들고 관리 [https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints?hl=ko]하는 방법 자세히 알아보기
관리형 조직 정책 제약조건 [https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=ko]의 전체 목록 참조하기
도움이 되었나요?
의견 보내기