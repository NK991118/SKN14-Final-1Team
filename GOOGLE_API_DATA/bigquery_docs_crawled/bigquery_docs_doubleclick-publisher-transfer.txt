Source URL: https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer

BigQuery [https://cloud.google.com/bigquery?hl=ko]
Documentation [https://cloud.google.com/bigquery/docs?hl=ko]
가이드 [https://cloud.google.com/bigquery/docs/introduction?hl=ko]
도움이 되었나요?
의견 보내기
이 페이지의 내용
지원되는 보고서 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#supported_reports]
Google Ad Manager 전송에서 데이터 수집 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#data_ingestion]
새로고침 기간 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#refresh]
데이터 전송(DT) 파일 업데이트 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#updates_to_data_transfer_dt_files]
데이터 이동 색인 업데이트 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#updates_to_match_tables]
BigQuery에 Google Ad Manager 데이터 로드
bookmark_border
Google Ad Manager용 BigQuery Data Transfer Service 커넥터를 사용하여 Google Ad Manager에서 BigQuery로 데이터를 로드할 수 있습니다. BigQuery Data Transfer Service를 사용하면 Google Ad Manager의 최신 데이터를 BigQuery에 추가하는 반복 전송 작업을 예약할 수 있습니다.
지원되는 보고서
Google Ad Manager 커넥터용 BigQuery Data Transfer Service는 다음과 같은 보고 옵션을 지원합니다.
데이터 전송(Google Ad Manager DT) 파일 [https://support.google.com/admanager/answer/1733124?hl=ko]
데이터 전송 필드 [https://support.google.com/admanager/table/7401123?hl=ko]
BigQuery Data Transfer Service에서 제공되는 데이터 이동 색인 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transformation?hl=ko]. 자동으로 생성되고 업데이트됩니다.
PQL로 가져온 데이터 이동 색인 [https://developers.google.com/doubleclick-publishers/docs/pqlreference?hl=ko#matchtables]
CompanyService의 데이터 이동 색인(v201908) [https://developers.google.com/doubleclick-publishers/docs/reference/v201908/CompanyService?hl=ko]
OrderService의 데이터 이동 색인(v201908) [https://developers.google.com/doubleclick-publishers/docs/reference/v201908/OrderService?hl=ko]
PlacementService의 데이터 이동 색인(v201908) [https://developers.google.com/doubleclick-publishers/docs/reference/v201908/PlacementService?hl=ko]
Google Ad Manager 보고서가 BigQuery 테이블 및 뷰로 변환되는 방식에 대한 자세한 내용은 Google Ad Manager 보고서 변환 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transformation?hl=ko]을 참조하세요.
참고: BigQuery Data Transfer Service는 탭( \t ), 파이프( | ), 캐럿( ^ ), 쉼표( , )와 같은 Google Ad Manager DT 파일 구분 기호를 지원합니다.
보고 옵션 지원
반복 빈도
기본적으로 8시간 간격
최소 4시간마다 구성 가능
새로고침 범위 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#refresh]
지난 2일
구성할 수 없음
최대 백필 기간
최근 60일
Google Ad Manager는 최대 60일 동안 데이터 전송 파일을 보관합니다. 60일이 지난 파일은 Google Ad Manager에서 삭제됩니다.
Google Ad Manager 전송에서 데이터 수집
Google Ad Manager에서 BigQuery로 데이터를 전송할 때는 데이터가 날짜별로 파티션을 나눈 BigQuery 테이블에 로드됩니다. 데이터가 로드되는 테이블 파티션은 데이터 소스의 날짜에 해당합니다. 동일한 날짜에 여러 전송을 예약하면 BigQuery Data Transfer Service가 해당 날짜의 파티션을 최신 데이터로 덮어씁니다. 동일한 일자에 전송이 여러 개 있거나 백필을 실행해도 데이터가 중복되지 않으며 다른 일자의 파티션에 영향을 주지 않습니다.
새로고침 기간
새로고침 기간은 데이터 전송이 발생할 때 데이터 전송이 데이터를 검색하는 일 수입니다. 예를 들어 새로고침 기간이 3일이고 일일 전송이 발생하는 경우 BigQuery Data Transfer Service는 소스 테이블에서 지난 3일 동안의 모든 데이터를 검색합니다. 이 예시에서 일일 전송이 발생하면 BigQuery Data Transfer Service는 현재 날짜의 소스 테이블 데이터 사본이 포함된 새 BigQuery 대상 테이블 파티션을 만든 다음 백필 실행을 자동으로 트리거하여 BigQuery 대상 테이블 파티션을 지난 2일 동안의 소스 테이블 데이터로 업데이트합니다. 자동으로 트리거된 백필 실행은 BigQuery Data Transfer Service 커넥터에서 증분 업데이트가 지원되는지 여부에 따라 BigQuery 대상 테이블을 덮어쓰거나 증분 업데이트합니다.
데이터 전송을 처음 실행하면 데이터 전송에서 새로고침 기간 내에 사용 가능한 모든 소스 데이터를 검색합니다. 예를 들어 새로고침 기간이 3일이고 데이터 전송을 처음 실행하면 BigQuery Data Transfer Service에서 3일 이내에 모든 소스 데이터를 검색합니다.
새로고침 기간은 TransferConfig.data_refresh_window_days API 필드 [https://cloud.google.com/bigquery/docs/reference/datatransfer/rest/v1/projects.locations.transferConfigs?hl=ko#TransferConfig.FIELDS.data_refresh_window_days]에 매핑됩니다.
새로고침 기간 외의 데이터(예: 이전 데이터)를 검색하거나 전송 중단 또는 불일치 문제를 해결하려면 백필 실행 [https://cloud.google.com/bigquery/docs/working-with-transfers?hl=ko#manually_trigger_a_transfer]을 시작하거나 예약하면 됩니다.
데이터 전송(DT) 파일 업데이트
Google Ad Manager 데이터 전송(Google Ad Manager DT) 파일에서 생성된 테이블을 점진적으로 업데이트할 수 있습니다. Google Ad Manager는 Google Ad Manager DT 파일을 Cloud Storage 버킷에 추가합니다. 그런 다음 전송 실행은 Cloud Storage 버킷에서 BigQuery 테이블로 새로운 Google Ad Manager DT 파일을 증분식으로 로드합니다. 이때 이미 BigQuery 테이블로 전송된 파일은 다시 로드되지 않습니다.
예를 들어 Google Ad Manager는 오전 1시에 file1을 버킷에 추가하고 오전 2시에 file2를 추가합니다. 오전 3시 30분에 전송이 실행되어 file1 및 file2를 BigQuery에 로드합니다. 그러면 Google Ad Manager에서 오전 5시에 file3을 추가하고 오전 6시에 file4를 추가합니다. 오전 7시 30분에 두 번째 전송 실행이 시작되고 파일 4개를 모두 로드하여 테이블을 덮어쓰는 대신 file3 및 file4를 BigQuery에 추가합니다.
데이터 이동 색인 업데이트
데이터 이동 색인은 데이터 전송 파일 내에 포함된 원시 값에 대한 조회 메커니즘을 제공합니다. 데이터 이동 색인 목록은 Google Ad Manager 보고서 변환 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transformation?hl=ko]을 참조하세요. 데이터 이동 색인은 서로 다른 수집 방법으로 업데이트됩니다. 데이터 이동 색인과 수집 방법은 다음 표에 나와 있습니다.
수집 방법 설명 데이터 이동 색인
증분 업데이트 증분 업데이트는 실행할 때마다 추가됩니다. 예를 들어 당일 첫 번째 전송 실행은 전송 실행 전에 수정된 모든 데이터를 로드하고 같은 날의 두 번째 전송 실행은 이전 실행 후 현재 실행 전에 수정된 데이터를 로드합니다. Company, Order, Placement, LineItem, AdUnit
전체 테이블 업데이트 전체 테이블 업데이트는 하루에 한 번 전체 테이블을 로드합니다. 예를 들어 당일 첫 번째 전송 실행은 테이블에 사용 가능한 모든 데이터를 로드합니다. 같은 날의 두 번째 전송 실행은 이러한 테이블 로드를 건너뜁니다. AdCategory, AudienceSegmentCategory, BandwidthGroup, Browser, BrowserLanguage, DeviceCapability, DeviceCategory, DeviceManufacturer, GeoTarget, MobileCarrier, MobileDevice, MobileDeviceSubmodel, OperatingSystem, OperatingSystemVersion, ThirdPartyCompany, TimeZone, User, ProgrammaticBuyer
전체 테이블 덮어쓰기 전송이 실행될 때마다 전체 테이블을 덮어씁니다. AudienceSegment
시작하기 전에
Google Ad Manager 데이터 전송을 만들기 전에 다음을 수행하세요.
BigQuery Data Transfer Service를 사용 [https://cloud.google.com/bigquery/docs/enable-transfer-service?hl=ko]하는 데 필요한 모든 작업을 완료했는지 확인합니다.
Google Ad Manager 데이터를 저장할 BigQuery 데이터세트를 만듭니다 [https://cloud.google.com/bigquery/docs/datasets?hl=ko].
조직이 Google Ad Manager 데이터 전송(Google Ad Manager DT) 파일에 액세스할 수 있어야 합니다. Google Ad Manager팀은 파일을 Google Cloud Storage 버킷으로 전달합니다. Google Ad Manager DT 파일에 대한 액세스 권한을 얻으려면 Ad Manager 데이터 전송 보고서 [https://support.google.com/admanager/answer/1733124?hl=ko]를 검토하세요. Google Ad Manager 팀에서 추가 요금이 청구될 수 있습니다.
이 단계를 마치고 나면 다음과 같은 Cloud Storage 버킷을 받게 됩니다.
    gdfp-12345678
  
Google Cloud 팀은 개발자를 대신하여 Google Ad Manager DT 파일에 대한 액세스 권한을 생성하거나 부여할 수 없습니다. Google Ad Manager DT 파일에 액세스하려면 Google Ad Manager 지원팀 [https://support.google.com/admanager/answer/3059042?ref_topic=7519191&hl=ko]에 문의하세요.
Google Ad Manager 네트워크에 대한 API 액세스 [https://support.google.com/admanager/answer/3088588?hl=ko]를 사용 설정하세요.
데이터 전송 알림을 설정하려면 Pub/Sub에 대한 pubsub.topics.setIamPolicy 권한이 있어야 합니다. 이메일 알림만 설정한다면 Pub/Sub 권한은 필요 없습니다. 자세한 내용은 BigQuery Data Transfer Service 실행 알림 [https://cloud.google.com/bigquery/docs/transfer-run-notifications?hl=ko]을 참조하세요.
필수 권한
BigQuery: 데이터 전송을 만드는 사람에게 다음과 같은 BigQuery의 권한이 있는지 확인합니다.
데이터 전송을 만드는 bigquery.transfers.update 권한
대상 데이터 세트에 대한 bigquery.datasets.get 및 bigquery.datasets.update 권한
사전 정의된 IAM 역할 bigquery.admin에는 bigquery.transfers.update, bigquery.datasets.update, bigquery.datasets.get 권한이 있습니다. BigQuery Data Transfer Service의 IAM 역할에 대한 자세한 내용은 액세스 제어 [https://cloud.google.com/bigquery/docs/access-control?hl=ko]를 확인하세요.
Google Ad Manager: Cloud Storage에 저장된 Google Ad Manager DT 파일에 대한 읽기 액세스. Google Ad Manager DT 파일에 대한 권한은 Google Ad Manager팀이 관리합니다. Google Ad Manager DT 파일 외에도 데이터 전송을 만드는 사람은 다양한 데이터 이동 색인 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transformation?hl=ko](항목, 주문, 광고 단위 등)을 만드는 데 필요한 모든 항목에 대한 읽기 액세스 권한이 있는 Google Ad Manager 네트워크에 추가해야 합니다. Ad Manager의 모든 항목팀 [https://support.google.com/admanager/answer/2445815?hl=ko#:~:text=All%20entities%C2%A0team,with%20their%20account]에 데이터 전송을 인증한 Ad Manager 사용자를 추가하면 이 작업을 수행할 수 있습니다.
Google Ad Manager 전송 설정
Google Ad Manager용 BigQuery 데이터 전송 설정에는 다음이 필요합니다.
Cloud Storage 버킷: Google Ad Manager DT 파일을 위한 Cloud Storage 버킷 URI(시작하기 전에 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#before_you_begin] 섹션 설명 참조). 버킷 이름은 다음과 같아야 합니다.
gdfp-12345678
네트워크 코드: 네트워크에 로그인하면 URL에서 Google Ad Manager 네트워크 코드를 찾을 수 있습니다. 예를 들어 https://admanager.google.com/2032576#delivery URL에서 2032576이 네트워크 코드입니다. 자세한 내용은 Google Ad Manager 시작하기 [https://developers.google.com/doubleclick-publishers/docs/start?hl=ko]를 참조하세요.
Google Ad Manager용 BigQuery Data Transfer Service 데이터 전송을 만들려면 다음 안내를 따르세요.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 데이터 전송 페이지로 이동합니다.

데이터 전송으로 이동 [https://console.cloud.google.com/bigquery/transfers?hl=ko] 
add 전송 만들기를 클릭합니다.
전송 만들기 페이지에서 다음을 수행합니다.


소스 유형 섹션의 소스에서 Google Ad Manager(이전 명칭: DFP)를 선택합니다.



 



전송 구성 이름 섹션의 표시 이름에 데이터 전송 이름(예: My Transfer)을 입력합니다. 나중에 전송을 수정해야 할 경우를 대비해 전송 이름은 전송을 식별할 수 있는 값이면 됩니다.



 



대상 설정 섹션의 데이터 세트에서 데이터를 저장하기 위해 만든 데이터 세트를 선택합니다.



 



데이터 소스 세부정보 섹션에서 다음을 수행합니다.

Cloud Storage 버킷에 데이터 전송 파일이 저장되는 Cloud Storage 버킷 이름을 입력합니다. 버킷 이름에는 gs://가 포함되면 안 됩니다.
네트워크 코드에 네트워크 코드를 입력합니다.




 



서비스 계정 메뉴에서 Google Cloud 프로젝트와 연결된 서비스 계정의 서비스 계정 [https://cloud.google.com/iam/docs/service-account-overview?hl=ko]을 선택합니다. 사용자 인증 정보를 사용하는 대신 서비스 계정을 전송에 연결할 수 있습니다. 데이터 전송에서 서비스 계정을 사용하는 방법에 관한 자세한 내용은 서비스 계정 사용 [https://cloud.google.com/bigquery/docs/use-service-accounts?hl=ko]을 참조하세요.

제휴 ID [https://cloud.google.com/iam/docs/workforce-identity-federation?hl=ko]로 로그인한 경우 전송을 만들려면 서비스 계정이 필요합니다. Google 계정으로 로그인한 경우 전송에 사용되는 서비스 계정은 선택사항입니다.
서비스 계정에는 필수 권한 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#required_permissions]이 있어야 합니다.
(선택사항) 알림 옵션 섹션에서 다음을 수행합니다.


전환을 클릭해서 이메일 알림을 사용 설정합니다. 이 옵션을 사용 설정하면 전송 실행이 실패할 때 전송 관리자에게 이메일 알림이 발송됩니다.
전환을 클릭하여 Pub/Sub 실행 알림을 사용 설정합니다. Cloud Pub/Sub 주제 선택에서 주제 이름을 선택하거나 주제 만들기를 클릭합니다. 이 옵션은 전송에 대한 Pub/Sub 실행 알림 [https://cloud.google.com/bigquery/docs/transfer-run-notifications?hl=ko]을 구성합니다.


저장을 클릭합니다.

--- 탭: bq [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#bq] ---
bq mk 명령어를 입력하고 전송 생성 플래그 --transfer_config를 지정합니다. 다음 플래그도 필요합니다.


--data_source
--target_dataset
--display_name
--params


선택적 플래그:


--service_account_name - 사용자 계정 대신 Google Ad Manager 전송 인증에 사용할 서비스 계정을 지정합니다.


bq mk --transfer_config \
--project_id=project_id \
--target_dataset=dataset \
--display_name=name \
--params='parameters' \
--data_source=data_source \
--service_account_name=service_account_name

각 항목의 의미는 다음과 같습니다.


project_id는 프로젝트 ID입니다.
dataset는 전송 구성 대상 데이터 세트입니다.
name은 데이터 전송 구성의 표시 이름입니다. 전송 이름은 나중에 수정해야 할 경우를 대비해 데이터 전송을 식별할 수 있는 값이면 됩니다.
parameters에는 JSON 형식으로 생성된 전송 구성의 매개변수가 있습니다. 예를 들면 --params='{"param":"param_value"}'입니다. Google Ad Manager의 경우 bucket 및 network_code 매개변수를 제공해야 합니다.

bucket: Google Ad Manager DT 파일이 포함된 Cloud Storage 버킷입니다.
network_code: 네트워크 코드입니다.
load_match_tables: 데이터 이동 색인을 로드할지 여부입니다. 기본적으로 True로 설정됩니다.

data_source는 데이터 소스입니다. 예를 들면 dfp_dt(Google Ad Manager)입니다.
service_account_name은 데이터 전송을 인증하는 데 사용되는 서비스 계정 이름입니다. 서비스 계정은 전송을 만드는 데 사용한 것과 동일한 project_id가 소유해야 하며 모든 필수 권한 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#required_permissions]이 있어야 합니다.

주의: 명령줄 도구를 사용하여 알림을 구성할 수 없습니다.
또한 --project_id 플래그를 입력하여 특정 프로젝트를 지정할 수도 있습니다. --project_id를 지정하지 않으면 기본 프로젝트가 사용됩니다.

예를 들어 다음 명령어는 네트워크 코드 12345678, Cloud Storage 버킷 gdfp-12345678, 대상 데이터 세트 mydataset를 사용하여 My Transfer라는 Google Ad Manager 데이터 전송을 만듭니다. 기본 프로젝트에 데이터 전송이 생성됩니다.
bq mk --transfer_config \
--target_dataset=mydataset \
--display_name='My Transfer' \
--params='{"bucket": "gdfp-12345678","network_code": "12345678"}' \
--data_source=dfp_dt

명령어를 실행한 후 다음과 같은 메시지가 수신됩니다.

[URL omitted] Please copy and paste the above URL into your web browser and
follow the instructions to retrieve an authentication code.

안내에 따라 인증 코드를 명령줄에 붙여넣습니다.

--- 탭: API [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#api] ---
projects.locations.transferConfigs.create [https://cloud.google.com/bigquery-transfer/docs/reference/datatransfer/rest/v1/projects.locations.transferConfigs/create?hl=ko] 메서드를 사용하고 TransferConfig [https://cloud.google.com/bigquery-transfer/docs/reference/datatransfer/rest/v1/projects.locations.transferConfigs?hl=ko#TransferConfig] 리소스의 인스턴스를 지정합니다.

--- 탭: 자바 [https://cloud.google.com/bigquery/docs/doubleclick-publisher-transfer?hl=ko#%EC%9E%90%EB%B0%94] ---
이 샘플을 사용해 보기 전에 BigQuery 빠른 시작: 클라이언트 라이브러리 사용 [https://cloud.google.com/bigquery/docs/quickstarts/quickstart-client-libraries?hl=ko]의 Java 설정 안내를 따르세요.
        
      
      
  자세한 내용은 BigQuery Java API 참고 문서 [https://cloud.google.com/java/docs/reference/google-cloud-bigquery/latest/overview?hl=ko]를 확인하세요.
  
    
    
      BigQuery에 인증하려면 애플리케이션 기본 사용자 인증 정보를 설정합니다.
      자세한 내용은 클라이언트 라이브러리의 인증 설정 [https://cloud.google.com/bigquery/docs/authentication?hl=ko#client-libs]을 참조하세요.
      
    
      






    
  
  
  
  




















  





  
    
  
  











  









  




  



  


  import com.google.api.gax.rpc.ApiException [https://cloud.google.com/java/docs/reference/gax/latest/com.google.api.gax.rpc.ApiException.html?hl=ko];
import com.google.cloud.bigquery.datatransfer.v1.CreateTransferConfigRequest [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.CreateTransferConfigRequest.html?hl=ko];
import com.google.cloud.bigquery.datatransfer.v1.DataTransferServiceClient [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.DataTransferServiceClient.html?hl=ko];
import com.google.cloud.bigquery.datatransfer.v1.ProjectName [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.ProjectName.html?hl=ko];
import com.google.cloud.bigquery.datatransfer.v1.TransferConfig [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.TransferConfig.html?hl=ko];
import com.google.protobuf.Struct [https://cloud.google.com/java/docs/reference/protobuf/latest/com.google.protobuf.Struct.html?hl=ko];
import com.google.protobuf.Value [https://cloud.google.com/java/docs/reference/protobuf/latest/com.google.protobuf.Value.html?hl=ko];
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

// Sample to create a ad manager(formerly DFP) transfer config
public class CreateAdManagerTransfer {

  public static void main(String[] args) throws IOException {
    // TODO(developer): Replace these variables before running the sample.
    final String projectId = "MY_PROJECT_ID";
    String datasetId = "MY_DATASET_ID";
    String bucket = "gs://cloud-sample-data";
    // the network_code can only be digits with length 1 to 15
    String networkCode = "12345678";
    Map<String, Value> params = new HashMap<>();
    params.put("bucket", Value [https://cloud.google.com/java/docs/reference/protobuf/latest/com.google.protobuf.Value.html?hl=ko].newBuilder().setStringValue(bucket).build());
    params.put("network_code", Value [https://cloud.google.com/java/docs/reference/protobuf/latest/com.google.protobuf.Value.html?hl=ko].newBuilder().setStringValue(networkCode).build());
    TransferConfig [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.TransferConfig.html?hl=ko] transferConfig =
        TransferConfig [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.TransferConfig.html?hl=ko].newBuilder()
            .setDestinationDatasetId(datasetId)
            .setDisplayName("Your Ad Manager Config Name")
            .setDataSourceId("dfp_dt")
            .setParams(Struct [https://cloud.google.com/java/docs/reference/protobuf/latest/com.google.protobuf.Struct.html?hl=ko].newBuilder().putAllFields [https://cloud.google.com/java/docs/reference/protobuf/latest/com.google.protobuf.Struct.Builder.html?hl=ko#com_google_protobuf_Struct_Builder_putAllFields_java_util_Map_java_lang_String_com_google_protobuf_Value__](params).build())
            .build();
    createAdManagerTransfer(projectId, transferConfig);
  }

  public static void createAdManagerTransfer(String projectId, TransferConfig [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.TransferConfig.html?hl=ko] transferConfig)
      throws IOException {
    try (DataTransferServiceClient [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.DataTransferServiceClient.html?hl=ko] client = DataTransferServiceClient [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.DataTransferServiceClient.html?hl=ko].create()) {
      ProjectName [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.ProjectName.html?hl=ko] parent = ProjectName [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.ProjectName.html?hl=ko].of(projectId);
      CreateTransferConfigRequest [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.CreateTransferConfigRequest.html?hl=ko] request =
          CreateTransferConfigRequest [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.CreateTransferConfigRequest.html?hl=ko].newBuilder()
              .setParent(parent.toString [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.ProjectName.html?hl=ko#com_google_cloud_bigquery_datatransfer_v1_ProjectName_toString__]())
              .setTransferConfig(transferConfig)
              .build();
      TransferConfig [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.TransferConfig.html?hl=ko] config = client.createTransferConfig(request);
      System.out.println("Ad manager transfer created successfully :" + config.getName [https://cloud.google.com/java/docs/reference/google-cloud-bigquerydatatransfer/latest/com.google.cloud.bigquery.datatransfer.v1.TransferConfig.html?hl=ko#com_google_cloud_bigquery_datatransfer_v1_TransferConfig_getName__]());
    } catch (ApiException [https://cloud.google.com/java/docs/reference/gax/latest/com.google.api.gax.rpc.ApiException.html?hl=ko] ex) {
      System.out.print("Ad manager transfer was not created." + ex.toString());
    }
  }
}
주의: 보고서의 스키마를 변경하는 경우 해당 날짜의 모든 파일 스키마는 동일해야 하며, 그렇지 않으면 해당 날짜 전체 데이터 전송이 실패합니다.
Google Ad Manager 전송 설정 문제 해결
데이터 전송을 설정하는 데 문제가 발생하면 전송 구성 문제 해결 [https://cloud.google.com/bigquery/docs/transfer-troubleshooting?hl=ko#google_ad_manager_transfer_issues]에서 Google Ad Manager 전송 문제 [https://cloud.google.com/bigquery/docs/transfer-troubleshooting?hl=ko]를 참조하세요.
데이터 쿼리
BigQuery로 전송되는 데이터는 내부 데이터화 시간별로 파티션을 나눈 테이블에 기록됩니다. 자세한 내용은 파티션을 나눈 테이블 소개 [https://cloud.google.com/bigquery/docs/partitioned-tables?hl=ko]를 참조하세요.
자동 생성된 뷰를 사용하지 않고 직접 테이블을 쿼리하는 경우에는 쿼리에서 _PARTITIONTIME 유사 열을 사용해야 합니다. 자세한 내용은 파티션을 나눈 테이블 쿼리 [https://cloud.google.com/bigquery/docs/querying-partitioned-tables?hl=ko]를 참조하세요.
샘플 쿼리
다음 Google Ad Manager 샘플 쿼리를 사용하여 전송된 데이터를 분석할 수 있습니다. Looker Studio [https://www.google.com/analytics/data-studio/?hl=ko]와 같은 시각화 도구에서 쿼리를 사용할 수도 있습니다. BigQuery로 Google Ad Manager 데이터 쿼리를 시작하는 데 유용합니다. 이 보고서로 할 수 있는 작업에 대해 추가 문의 사항이 있는 경우, Google Ad Manager 기술 담당자에게 문의하세요.
참고: 자동 생성된 뷰를 사용하지 않고 직접 테이블을 쿼리하는 경우에는 쿼리에서 _PARTITIONTIME 유사 열을 사용해야 합니다. 자세한 내용은 파티션을 나눈 테이블 쿼리 [https://cloud.google.com/bigquery/docs/querying-partitioned-tables?hl=ko]를 참조하세요.
다음 각 쿼리에서 dataset와 같은 변수를 실제 값으로 바꿉니다. 예를 들어 network_code는 Google Ad Manager 네트워크 코드로 바꿉니다.
도시별 노출수와 순 사용자
다음 SQL 샘플 쿼리는 지난 30일 동안의 도시별 노출수와 순 사용자를 분석합니다.
# START_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -31 DAY)
# END_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -1 DAY)
SELECT
  City,
  _DATA_DATE AS Date,
  count(*) AS imps,
  count(distinct UserId) AS uniq_users
FROM `
dataset.NetworkImpressions_
network_code`
WHERE
  _DATA_DATE BETWEEN 
start_date AND 
end_date
GROUP BY City, Date
항목 유형별 노출수와 순 사용자
다음 SQL 샘플 쿼리는 지난 30일 동안의 항목 유형별 노출수와 순 사용자를 분석합니다.
# START_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -31 DAY)
# END_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -1 DAY)
SELECT
  MT.LineItemType AS LineItemType,
  DT._DATA_DATE AS Date,
  count(*) AS imps,
  count(distinct UserId) AS uniq_users
FROM `
dataset.NetworkImpressions_
network_code` AS DT
LEFT JOIN `
dataset.MatchTableLineItem_
network_code` AS MT
ON
  DT.LineItemId = MT.Id
WHERE
  DT._DATA_DATE BETWEEN 
start_date AND 
end_date
GROUP BY LineItemType, Date
ORDER BY Date desc, imps desc
광고 단위별 노출수
다음 SQL 샘플 쿼리는 지난 30일 동안의 광고 단위별 노출수를 분석합니다.
# START_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -31 DAY)
# END_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -1 DAY)
SELECT
  MT.AdUnitCode AS AdUnitCode,
  DT.DATA_DATE AS Date,
  count(*) AS imps
FROM `
dataset.NetworkImpressions_
network_code` AS DT
LEFT JOIN `
dataset.MatchTableAdUnit_
network_code` AS MT
ON
  DT.AdUnitId = MT.Id
WHERE
  DT._DATA_DATE BETWEEN 
start_date AND 
end_date
GROUP BY AdUnitCode, Date
ORDER BY Date desc, imps desc
광고 항목별 노출수
다음 SQL 샘플 쿼리는 지난 30일 동안의 광고 항목별 노출수를 분석합니다.
# START_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -31 DAY)
# END_DATE = DATE_ADD(CURRENT_DATE(), INTERVAL -1 DAY)
SELECT
  MT.Name AS LineItemName,
  DT._DATA_DATE AS Date,
  count(*) AS imps
FROM `
dataset.NetworkImpressions_
network_code` AS DT
LEFT JOIN `
dataset.MatchTableLineItem_
network_code` AS MT
ON
  DT.LineItemId = MT.Id
WHERE
  DT._DATA_DATE BETWEEN 
start_date AND 
end_date
GROUP BY LineItemName, Date
ORDER BY Date desc, imps desc
도움이 되었나요?
의견 보내기