Source URL: https://cloud.google.com/bigquery/docs/connect-to-spanner

BigQuery [https://cloud.google.com/bigquery?hl=ko]
Documentation [https://cloud.google.com/bigquery/docs?hl=ko]
가이드 [https://cloud.google.com/bigquery/docs/introduction?hl=ko]
도움이 되었나요?
의견 보내기
이 페이지의 내용
시작하기 전에 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#before_you_begin]
Spanner 연결 만들기 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#create-spanner-connection]
사용자와 연결 공유 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#share_connections]
다음 단계 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#whats_next]
Spanner에 연결
bookmark_border
BigQuery 관리자는 Spanner 데이터 액세스를 위한 연결 [https://cloud.google.com/bigquery/docs/connections-api-intro?hl=ko]을 만들 수 있습니다. 이 연결을 사용하면 데이터 분석가는 Spanner에서 데이터를 쿼리 [https://cloud.google.com/bigquery/docs/spanner-federated-queries?hl=ko]할 수 있습니다.
시작하기 전에
BigQuery Connection API를 사용 설정합니다.
API 사용 설정하기 [https://console.cloud.google.com/apis/library/bigqueryconnection.googleapis.com?hl=ko]
Spanner에 연결하는 데 필요한 권한을 얻으려면 관리자에게 프로젝트에 대한 BigQuery 연결 관리자 [https://cloud.google.com/iam/docs/roles-permissions/bigquery?hl=ko#bigquery.connectionAdmin](roles/bigquery.connectionAdmin) IAM 역할을 부여해 달라고 요청하세요. 역할 부여에 대한 자세한 내용은 프로젝트, 폴더, 조직에 대한 액세스 관리 [https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=ko]를 참조하세요.
커스텀 역할 [https://cloud.google.com/iam/docs/creating-custom-roles?hl=ko]이나 다른 사전 정의된 역할 [https://cloud.google.com/iam/docs/roles-overview?hl=ko#predefined]을 통해 필요한 권한을 얻을 수도 있습니다.
Spanner 연결 만들기
다음 옵션 중 하나를 선택합니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#%EC%BD%98%EC%86%94] ---
BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
탐색기 창에서 add 데이터 추가를 클릭합니다.

데이터 추가 대화상자가 열립니다.
필터링 기준 창의 데이터 소스 유형 섹션에서 데이터베이스를 선택합니다.

또는 데이터 소스 검색 필드에 Spanner을 입력할 수 있습니다.
추천 데이터 소스 섹션에서 Google Cloud Spanner를 클릭합니다.
Google Cloud Spanner: BigQuery 페더레이션 솔루션 카드를 클릭합니다.
외부 데이터 소스 창에서 다음 정보를 입력합니다.


연결 유형에 Cloud Spanner를 선택합니다.
연결 ID에는 연결 리소스의 식별자를 입력합니다. 문자, 숫자, 밑줄을 사용할 수 있습니다.
위치 유형에서 외부 데이터 소스 리전과 호환되는 [https://cloud.google.com/bigquery/docs/federated-queries-intro?hl=ko#supported_regions] BigQuery 위치(또는 리전)를 선택합니다.
선택사항: 별칭에 사용자 친화적인 연결 이름(예: My connection resource)을 입력합니다. 사용자 친화적인 이름으로 나중에 수정해야 하는 경우 연결 리소스를 식별하는 데 도움이 되는 모든 값을 사용할 수 있습니다.
선택사항: 설명에 이 연결 리소스에 대한 설명을 입력합니다.
데이터베이스 이름에 Spanner 데이터베이스를 "projects/PROJECT_ID/instances/INSTANCE/databases/DATABASE" 형식으로 입력합니다.
선택사항: 병렬 읽기를 수행하려면 동시에 데이터 읽기를 선택합니다. Spanner에서는 특정 쿼리를 더 작은 부분이나 파티션 여러 개로 나누고 파티션을 동시에 가져올 수 있습니다.
자세한 내용은 Spanner 문서의 동시에 데이터 읽기 [https://cloud.google.com/spanner/docs/reads?hl=ko#read_data_in_parallel]를 참조하세요. 이 옵션은 실행 계획의 첫 번째 연산자가 분산 통합 [https://cloud.google.com/spanner/docs/query-execution-operators?hl=ko#distributed-union] 연산자인 쿼리로 제한됩니다. 다른 쿼리는 오류를 반환합니다. Spanner 쿼리의 쿼리 실행 계획을 보려면 Spanner의 쿼리 실행 방법 이해 [https://cloud.google.com/spanner/docs/sql-best-practices?hl=ko#how-execute-queries]를 참조하세요.
선택사항: 데이터베이스 역할에 Spanner 데이터베이스 역할의 이름을 입력합니다. 비어 있지 않은 경우 이 연결은 기본적으로 이 데이터베이스 역할을 사용하여 Spanner를 쿼리합니다. 이 연결을 통해 쿼리를 제출하는 세분화된 액세스 제어 사용자는 관리자로부터 이 역할에 대한 액세스 권한을 부여받아야 하며, 데이터베이스 역할에는 외부 쿼리에 지정된 모든 스키마 객체에 대한 SELECT 권한이 있어야 합니다. 세분화된 액세스 제어에 대한 자세한 내용은 세분화된 액세스 제어 정보 [https://cloud.google.com/spanner/docs/fgac-about?hl=ko]를 참조하세요.
선택사항: Data Boost를 사용 설정하려면 Spanner Data Boost 사용을 선택합니다. Data Boost [https://cloud.google.com/bigquery/docs/spanner-federated-queries?hl=ko#data_boost]를 사용하면 프로비저닝된 BigQuery 인스턴스의 기존 워크로드에 거의 영향을 주지 않고 분석 쿼리 및 데이터 내보내기를 실행할 수 있습니다. Data Boost를 사용 설정하려면 Data Boost 및 데이터 병렬로 읽기를 선택합니다.

연결 만들기를 클릭합니다.

--- 탭: bq [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#bq] ---
연결을 만들려면 --connection 플래그와 함께 bq mk [https://cloud.google.com/bigquery/docs/reference/bq-cli-reference?hl=ko#mk-connection] 명령어를 사용합니다.

bq mk --connection \
    --connection_type=CLOUD_SPANNER \
    --properties='PROPERTIES' \
    --location=LOCATION \
    --display_name='FRIENDLY_NAME' \
    --description 'DESCRIPTION' \
    CONNECTION_ID

다음을 바꿉니다.


PROPERTIES: 다음 필드가 있는 JSON 객체입니다.


"database": 연결에 사용되는 Spanner 데이터베이스입니다.

"projects/PROJECT_ID/instances/INSTANCE/databases/DATABASE" 형식의 문자열로 지정합니다.
"use_parallelism": (선택사항) true인 경우 이 연결은 병렬 읽기를 수행합니다.

기본값은 false입니다. Spanner에서는 특정 쿼리를 더 작은 부분이나 파티션 여러 개로 나누고 파티션을 동시에 가져올 수 있습니다. 자세한 내용은 Spanner 문서의 동시에 데이터 읽기 [https://cloud.google.com/spanner/docs/reads?hl=ko#read_data_in_parallel]를 참조하세요. 이 옵션은 실행 계획의 첫 번째 연산자가 분산 통합 [https://cloud.google.com/spanner/docs/query-execution-operators?hl=ko#distributed-union] 연산자인 쿼리로 제한됩니다. 다른 쿼리는 오류를 반환합니다. Spanner 쿼리의 쿼리 실행 계획을 보려면 Spanner의 쿼리 실행 방법 이해 [https://cloud.google.com/spanner/docs/sql-best-practices?hl=ko#how-execute-queries]를 참조하세요.
"database_role": (선택사항) 비어 있지 않은 경우 이 연결은 기본적으로 이 데이터베이스 역할을 사용하여 Spanner를 쿼리합니다.
이 연결을 통해 쿼리를 제출하는 세분화된 액세스 제어 사용자는 관리자로부터 이 역할에 대한 액세스 권한을 부여받아야 하며, 데이터베이스 역할에는 외부 쿼리에 지정된 모든 스키마 객체에 대한 SELECT 권한이 있어야 합니다.

지정되지 않은 경우 이 연결은 Spanner에 대한 사전 정의된 IAM 역할로 인증되며 이 연결로 쿼리를 실행하는 주 구성원에게 roles/spanner.databaseReader IAM 역할을 부여해야 합니다.

세분화된 액세스 제어에 대한 자세한 내용은 세분화된 액세스 제어 정보 [https://cloud.google.com/spanner/docs/fgac-about?hl=ko]를 참조하세요.
"useDataBoost": (선택사항) true인 경우 이 연결을 통해 Data Boost [https://cloud.google.com/bigquery/docs/spanner-federated-queries?hl=ko#data_boost]를 사용할 수 있습니다. Data Boost를 사용하면 사용자는 프로비저닝된 인스턴스와 다른 별도의 독립적인 컴퓨팅 용량에서 통합 쿼리를 실행하여 기존 워크로드에 영향을 주지 않도록 할 수 있습니다. Data Boost를 사용 설정하려면 "useDataBoost"를 true로, "use_parallelism"을 true로 설정합니다.

Data Boost를 사용하려면 이 연결로 쿼리를 실행하는 주 구성원에게 spanner.databases.useDataBoost 권한이 부여되어야 합니다. 이 권한은 기본적으로 roles/spanner.admin 및 roles/spanner.databaseAdmin 역할에 포함되어 있습니다.

LOCATION: 외부 데이터 소스 리전과 호환 [https://cloud.google.com/bigquery/docs/federated-queries-intro?hl=ko#supported_regions]되는 BigQuery 위치입니다.
CONNECTION_ID: 연결 리소스의 식별자입니다.

연결 ID에는 문자, 숫자, 밑줄이 포함될 수 있습니다.
연결 ID를 제공하지 않으면 BigQuery에서 자동으로 고유 ID를 생성합니다.

다음 예시에서는 my_connection_id라는 새 연결 리소스를 만듭니다.

bq mk --connection \
  --connection_type='CLOUD_SPANNER' \
  --properties='{"database":"projects/my_project/instances/my_instance/databases/database1"}' \
  --project_id=federation-test \
  --location=us \
  my_connection_id

--- 탭: API [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#api] ---
ConnectionService 서비스 내에서 CreateConnection 메서드 [https://cloud.google.com/bigquery/docs/reference/bigqueryconnection/rpc/google.cloud.bigquery.connection.v1?hl=ko#createconnectionrequest]를 호출합니다.
사용자와 연결 공유
데이터를 쿼리하고 연결을 관리할 수 있도록 사용자에게 다음 역할을 부여할 수 있습니다.
roles/bigquery.connectionUser: 사용자가 연결을 사용하여 외부 데이터 소스에 연결하고 쿼리를 실행할 수 있습니다.
roles/bigquery.connectionAdmin: 사용자가 연결을 관리할 수 있습니다.
BigQuery의 IAM 역할과 권한에 대한 자세한 내용은 사전 정의된 역할 및 권한 [https://cloud.google.com/bigquery/access-control?hl=ko]을 참조하세요.
다음 옵션 중 하나를 선택합니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#%EC%BD%98%EC%86%94] ---
BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 

이러한 연결은 프로젝트의 외부 연결 그룹에 나열됩니다.
탐색기 창에서 프로젝트 이름 > 외부 연결 > 연결을 클릭합니다.
세부정보 창에서 공유를 클릭하여 연결을 공유합니다.
다음 작업을 수행합니다.


연결 권한 대화상자에서 주 구성원을 추가하거나 수정하여 다른 주 구성원과 연결을 공유합니다.
저장을 클릭합니다.

--- 탭: bq [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#bq] ---
bq 명령줄 도구로 연결을 공유할 수 없습니다.
연결을 공유하려면 Google Cloud 콘솔 또는 BigQuery Connections API 메서드를 사용하여 연결을 공유합니다.

--- 탭: API [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#api] ---
BigQuery 연결 REST API 참조 섹션의 projects.locations.connections.setIAM 메서드 [https://cloud.google.com/bigquery/docs/reference/bigqueryconnection/rest/v1/projects.locations.connections?hl=ko#methods]를 사용하고 policy 리소스의 인스턴스를 지정합니다.

--- 탭: 자바 [https://cloud.google.com/bigquery/docs/connect-to-spanner?hl=ko#%EC%9E%90%EB%B0%94] ---
이 샘플을 사용해 보기 전에 BigQuery 빠른 시작: 클라이언트 라이브러리 사용 [https://cloud.google.com/bigquery/docs/quickstarts/quickstart-client-libraries?hl=ko]의 Java 설정 안내를 따르세요.
        
      
      
  자세한 내용은 BigQuery Java API 참고 문서 [https://cloud.google.com/java/docs/reference/google-cloud-bigquery/latest/overview?hl=ko]를 확인하세요.
  
    
    
      BigQuery에 인증하려면 애플리케이션 기본 사용자 인증 정보를 설정합니다.
      자세한 내용은 클라이언트 라이브러리의 인증 설정 [https://cloud.google.com/bigquery/docs/authentication?hl=ko#client-libs]을 참조하세요.
      
    
      






    
  
  
  
  




















  





  
    
  
  











  









  




  



  


  import com.google.api.resourcenames.ResourceName [https://cloud.google.com/java/docs/reference/api-common/latest/com.google.api.resourcenames.ResourceName.html?hl=ko];
import com.google.cloud.bigquery.connection.v1.ConnectionName [https://cloud.google.com/java/docs/reference/google-cloud-bigqueryconnection/latest/com.google.cloud.bigquery.connection.v1.ConnectionName.html?hl=ko];
import com.google.cloud.bigqueryconnection.v1.ConnectionServiceClient [https://cloud.google.com/java/docs/reference/google-cloud-bigqueryconnection/latest/com.google.cloud.bigqueryconnection.v1.ConnectionServiceClient.html?hl=ko];
import com.google.iam.v1.Binding [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Binding.html?hl=ko];
import com.google.iam.v1.Policy [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Policy.html?hl=ko];
import com.google.iam.v1.SetIamPolicyRequest [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.SetIamPolicyRequest.html?hl=ko];
import java.io.IOException;

// Sample to share connections
public class ShareConnection {

  public static void main(String[] args) throws IOException {
    // TODO(developer): Replace these variables before running the sample.
    String projectId = "MY_PROJECT_ID";
    String location = "MY_LOCATION";
    String connectionId = "MY_CONNECTION_ID";
    shareConnection(projectId, location, connectionId);
  }

  static void shareConnection(String projectId, String location, String connectionId)
      throws IOException {
    try (ConnectionServiceClient [https://cloud.google.com/java/docs/reference/google-cloud-bigqueryconnection/latest/com.google.cloud.bigqueryconnection.v1.ConnectionServiceClient.html?hl=ko] client = ConnectionServiceClient [https://cloud.google.com/java/docs/reference/google-cloud-bigqueryconnection/latest/com.google.cloud.bigqueryconnection.v1.ConnectionServiceClient.html?hl=ko].create()) {
      ResourceName [https://cloud.google.com/java/docs/reference/api-common/latest/com.google.api.resourcenames.ResourceName.html?hl=ko] resource = ConnectionName [https://cloud.google.com/java/docs/reference/google-cloud-bigqueryconnection/latest/com.google.cloud.bigquery.connection.v1.ConnectionName.html?hl=ko].of(projectId, location, connectionId);
      Binding [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Binding.html?hl=ko] binding =
          Binding [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Binding.html?hl=ko].newBuilder()
              .addMembers [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Binding.Builder.html?hl=ko#com_google_iam_v1_Binding_Builder_addMembers_java_lang_String_]("group:example-analyst-group@google.com")
              .setRole("roles/bigquery.connectionUser")
              .build();
      Policy [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Policy.html?hl=ko] policy = Policy [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Policy.html?hl=ko].newBuilder().addBindings [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.Policy.Builder.html?hl=ko#com_google_iam_v1_Policy_Builder_addBindings_com_google_iam_v1_Binding_](binding).build();
      SetIamPolicyRequest [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.SetIamPolicyRequest.html?hl=ko] request =
          SetIamPolicyRequest [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.SetIamPolicyRequest.html?hl=ko].newBuilder()
              .setResource(resource.toString())
              .setPolicy [https://cloud.google.com/java/docs/reference/proto-google-iam-v1/latest/com.google.iam.v1.SetIamPolicyRequest.Builder.html?hl=ko#com_google_iam_v1_SetIamPolicyRequest_Builder_setPolicy_com_google_iam_v1_Policy_](policy)
              .build();
      client.setIamPolicy(request);
      System.out.println("Connection shared successfully");
    }
  }
}
다음 단계
다양한 연결 유형 [https://cloud.google.com/bigquery/docs/connections-api-intro?hl=ko] 알아보기
연결 관리 [https://cloud.google.com/bigquery/docs/working-with-connections?hl=ko] 알아보기
통합 쿼리 [https://cloud.google.com/bigquery/docs/federated-queries-intro?hl=ko] 알아보기
Spanner 데이터 쿼리 [https://cloud.google.com/bigquery/docs/spanner-federated-queries?hl=ko] 방법 알아보기
도움이 되었나요?
의견 보내기