Source URL: https://cloud.google.com/bigquery/docs/reservations-tasks

BigQuery [https://cloud.google.com/bigquery?hl=ko]
Documentation [https://cloud.google.com/bigquery/docs?hl=ko]
가이드 [https://cloud.google.com/bigquery/docs/introduction?hl=ko]
도움이 되었나요?
의견 보내기
이 페이지의 내용
예약 작성 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#create_reservations]
필수 권한 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#required_permissions]
전용 슬롯이 있는 예약 만들기 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#create_a_reservation_with_dedicated_slots]
예측 가능한 예약 만들기 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#predictable]
예약 업데이트 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#update_reservations]
필수 권한 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#required_permissions_2]
예약 크기 변경 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#change_the_size_of_a_reservation]
쿼리에서 유휴 슬롯을 사용할지 구성 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#configure_whether_queries_use_idle_slots]
슬롯 예약 작업
bookmark_border
BigQuery Reservation API를 사용하면 전용 슬롯(약정 [https://cloud.google.com/bigquery/docs/reservations-intro?hl=ko#commitments])을 구입하고, 슬롯 풀(예약 [https://cloud.google.com/bigquery/docs/reservations-intro?hl=ko#reservations])을 만들고, 이러한 예약에 프로젝트, 폴더, 조직을 할당할 수 있습니다.
예약을 사용하면 워크로드에 전용 슬롯 수를 할당할 수 있습니다. 예를 들어 프로덕션 워크로드가 테스트 워크로드와 슬롯을 경합하는 경우가 발생하지 않아야 할 수 있습니다. 이를 위해서는 prod라는 예약을 만들고 이 예약에 프로덕션 워크로드를 할당할 수 있습니다. 자세한 내용은 예약 [https://cloud.google.com/bigquery/docs/reservations-intro?hl=ko#reservations]을 참조하세요.
예약 작성
필수 권한
예약을 만들려면 Identity and Access Management(IAM) 권한이 필요합니다.
약정의 소유권을 유지하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 bigquery.reservations.create
사전 정의된 다음의 각 IAM 역할에는 이 권한이 포함되어 있습니다.
BigQuery Resource Editor
BigQuery Resource Admin
BigQuery에서 IAM 역할에 대한 자세한 내용은 사전 정의된 역할 및 권한 [https://cloud.google.com/bigquery/docs/access-control?hl=ko]을 참조하세요.
전용 슬롯이 있는 예약 만들기
다음 옵션 중 하나를 선택합니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
탐색 메뉴에서 용량 관리를 클릭합니다.
예약 생성을 클릭합니다.
예약 이름 필드에 예약 이름을 입력합니다.
위치 목록에서 위치를 선택합니다. BigQuery Omni 위치 [https://cloud.google.com/bigquery/docs/omni-introduction?hl=ko#locations]를 선택하면 버전 옵션이 Enterprise 버전으로 제한됩니다.
버전 목록에서 버전을 선택합니다. 자동 확장과 같은 BigQuery 버전 기능은 한 버전 내에서만 사용할 수 있습니다. 자세한 내용은 BigQuery 버전 소개 [https://cloud.google.com/bigquery/docs/editions-intro?hl=ko]를 참조하세요.
최대 예약 크기 선택기 목록에서 최대 예약 크기를 선택합니다.
(선택사항) 기준 슬롯 필드에 예약의 기준 슬롯 수를 입력합니다.

사용 가능한 자동 확장 슬롯 수는 최대 예약 크기에서 기준 슬롯 값을 빼서 결정됩니다. 예를 들어 기준 슬롯이 100개이고 최대 예약 크기가 400개인 예약을 만들면 예약의 자동 확장 슬롯은 300개입니다. 기준 슬롯에 대한 자세한 내용은 기준 및 자동 확장 슬롯이 있는 예약 사용 [https://cloud.google.com/bigquery/docs/slots-autoscaling-intro?hl=ko#using_reservations_with_baseline_and_autoscaling_slots]을 참조하세요.
유휴 슬롯 공유 [https://cloud.google.com/bigquery/docs/slots?hl=ko#idle_slots]를 사용 중지하고 지정된 슬롯 용량만 사용하려면 유휴 슬롯 무시 전환 버튼을 클릭합니다.
고급 설정 섹션을 펼치려면 expand_more 펼치기 화살표를 클릭합니다.
(선택사항): 대상 작업 동시 실행을 설정하려면 자동 대상 작업 동시 실행 재정의 전환 버튼을 클릭하여 대상 작업 동시 실행을 입력합니다.
슬롯 분석은 예상 비용 테이블에 표시됩니다.
예약 요약은 용량 요약 테이블에 표시됩니다.
저장을 클릭합니다.


새 예약이 슬롯 예약 탭에 표시됩니다.

--- 탭: SQL [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#sql] ---
예약을 만들려면 CREATE RESERVATION DDL 문 [https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language?hl=ko#create_reservation_statement]을 사용합니다.






 Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
쿼리 편집기에서 다음 문을 입력합니다.

CREATE RESERVATION
  `ADMIN_PROJECT_ID.region-LOCATION.RESERVATION_NAME`
OPTIONS (
  slot_capacity = NUMBER_OF_BASELINE_SLOTS,
  edition = EDITION,
  autoscale_max_slots = NUMBER_OF_AUTOSCALING_SLOTS);


다음을 바꿉니다.

  ADMIN_PROJECT_ID: 예약 리소스를 소유하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
  LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]. BigQuery Omni 위치 [https://cloud.google.com/bigquery/docs/omni-introduction?hl=ko#locations]를 선택하면 버전 옵션이 Enterprise 버전으로 제한됩니다.
  RESERVATION_NAME: 예약 이름
    이름에는 소문자 영숫자 문자 또는 대시만 포함할 수 있고, 문자로 시작해야 하며 대시로 끝나서는 안 되고, 최대 길이는 64자입니다.
  NUMBER_OF_BASELINE_SLOTS: 예약에 할당할 기준 슬롯 수. 동일한 예약에 slot_capacity 옵션 및 edition 옵션을 설정할 수 없습니다.
  EDITION: 예약 버전. 버전에 예약을 할당하면 기능 및 가격이 변경됩니다. 자세한 내용은 BigQuery 버전 소개 [https://cloud.google.com/bigquery/docs/editions-intro?hl=ko]를 참조하세요.
  
  NUMBER_OF_AUTOSCALING_SLOTS: 예약에 할당된 자동 확장 슬롯 수. 최대 예약 크기 값에서 기준 슬롯 수를 뺀 값과 동일합니다.
  


play_circle 실행을 클릭합니다.




쿼리를 실행하는 방법에 대한 자세한 내용은 대화형 쿼리 실행 [https://cloud.google.com/bigquery/docs/running-queries?hl=ko#queries]을 참조하세요.

--- 탭: bq [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#bq] ---
예약을 만들려면 bq mk 명령어를 --reservation 플래그와 함께 실행합니다.

bq mk \
    --project_id=ADMIN_PROJECT_ID \
    --location=LOCATION \
    --reservation \
    --slots=NUMBER_OF_BASELINE_SLOTS \
    --ignore_idle_slots=false \
    --edition=EDITION \
    --autoscale_max_slots=NUMBER_OF_AUTOSCALING_SLOTS \
    --max_slots=MAXIMUM_NUMBER_OF_SLOTS
    --scaling_mode=SCALING_MODE
    RESERVATION_NAME


다음을 바꿉니다.


ADMIN_PROJECT_ID: 프로젝트 ID
LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko] BigQuery Omni 위치 [https://cloud.google.com/bigquery/docs/omni-introduction?hl=ko#locations]를 선택하면 버전 옵션이 Enterprise 버전으로 제한됩니다.
NUMBER_OF_BASELINE_SLOTS: 예약에 할당할 기준 슬롯 수
RESERVATION_NAME: 예약 이름. 이름에는 소문자 영숫자 문자 또는 대시만 포함할 수 있고, 문자로 시작해야 하며 대시로 끝나서는 안 되고, 최대 길이는 64자입니다.
EDITION: 예약 버전. 버전에 예약을 할당하면 기능 및 가격이 변경됩니다. 자세한 내용은 BigQuery 버전 소개 [https://cloud.google.com/bigquery/docs/editions-intro?hl=ko]를 참조하세요.
NUMBER_OF_AUTOSCALING_SLOTS: 예약에 할당된 자동 확장 슬롯 수. 최대 예약 크기 값에서 기준 슬롯 수를 뺀 값과 동일합니다. --max_slots 또는 --scaling_mode 플래그로 구성할 수 없습니다.
MAXIMUM_NUMBER_OF_SLOTS: 예약에서 사용할 수 있는 최대 슬롯 수입니다. 이 값은 --scaling_mode 플래그(프리뷰 [https://cloud.google.com/products?hl=ko#product-launch-stages])로 구성해야 합니다.
SCALING_MODE: 예약의 확장 모드입니다. 옵션은 ALL_SLOTS, IDLE_SLOTS_ONLY 또는 AUTOSCALE_ONLY입니다. 이 값은 --scaling_mode 플래그(프리뷰 [https://cloud.google.com/products?hl=ko#product-launch-stages])로 구성해야 합니다.


--ignore_idle_slots 플래그에 대한 자세한 내용은 유휴 슬롯 [https://cloud.google.com/bigquery/docs/slots?hl=ko#idle_slots]을 참조하세요. 기본값은 false입니다.

--- 탭: Terraform [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#terraform] ---
google_bigquery_reservation [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_reservation] 리소스를 사용합니다.
참고: Terraform을 사용해서 BigQuery 객체를 만들려면 Cloud Resource Manager API [https://cloud.google.com/resource-manager/reference/rest?hl=ko]를 사용 설정해야 합니다.
BigQuery에 인증하려면 애플리케이션 기본 사용자 인증 정보를 설정합니다. 자세한 내용은 클라이언트 라이브러리의 인증 설정 [https://cloud.google.com/bigquery/docs/authentication?hl=ko#client-libs]을 참조하세요.

다음 예시에서는 my-reservation이라는 예약을 만듭니다.






















  





  
    
  
  



















  




  



  


  resource "google_bigquery_reservation" "default" {
  name              = "my-reservation"
  location          = "us-central1"
  slot_capacity     = 100
  edition           = "ENTERPRISE"
  ignore_idle_slots = false # Use idle slots from other reservations
  concurrency       = 0     # Automatically adjust query concurrency based on available resources
  autoscale {
    max_slots = 200 # Allow the reservation to scale up to 300 slots (slot_capacity + max_slots) if needed
  }
}





























프로젝트에 Terraform 구성을 적용하려면 Google Cloud 다음 섹션의 단계를 완료하세요.
Cloud Shell 준비

  Cloud Shell [https://shell.cloud.google.com/?hl=ko]을 실행합니다.
  
    Terraform 구성을 적용할 기본 Google Cloud 프로젝트를 설정합니다.
    이 명령어는 프로젝트당 한 번만 실행하면 되며 어떤 디렉터리에서도 실행할 수 있습니다.
    export GOOGLE_CLOUD_PROJECT=PROJECT_ID
    Terraform 구성 파일에서 명시적 값을 설정하면 환경 변수가 재정의됩니다.
  

디렉터리 준비
각 Terraform 구성 파일에는 자체 디렉터리(루트 모듈이라고도 함)가 있어야 합니다.

  
    Cloud Shell [https://shell.cloud.google.com/?hl=ko]에서 디렉터리를 만들고 해당 디렉터리 내에 새 파일을 만드세요. 파일 이름에는 .tf 확장자가 있어야 합니다(예: main.tf). 이 튜토리얼에서는 파일을 main.tf라고 합니다.
    mkdir DIRECTORY && cd DIRECTORY && touch main.tf
  
  
    튜토리얼을 따라 하는 경우 각 섹션이나 단계에서 샘플 코드를 복사할 수 있습니다.
    샘플 코드를 새로 만든 main.tf에 복사합니다.
    필요한 경우 GitHub에서 코드를 복사합니다. 이는 Terraform 스니펫이 엔드 투 엔드 솔루션의 일부인 경우에 권장됩니다.
    
  
  환경에 적용할 샘플 파라미터를 검토하고 수정합니다.
  변경사항을 저장합니다.
  
    Terraform을 초기화합니다. 이 작업은 디렉터리당 한 번만 수행하면 됩니다.
    terraform init
    원하는 경우 최신 Google 공급업체 버전을 사용하려면 -upgrade 옵션을 포함합니다.
    
    terraform init -upgrade
  

변경사항 적용

  
    구성을 검토하고 Terraform에서 만들거나 업데이트할 리소스가 예상과 일치하는지 확인합니다.
    terraform plan
    필요에 따라 구성을 수정합니다.
  
  
    다음 명령어를 실행하고 프롬프트에 yes를 입력하여 Terraform 구성을 적용합니다.
    terraform apply
    Terraform에 '적용 완료' 메시지가 표시될 때까지 기다립니다.
  
  결과를 보려면 Google Cloud 프로젝트 [https://console.cloud.google.com/?hl=ko]를 엽니다. Google Cloud 콘솔에서 UI의 리소스로 이동하여 Terraform이 리소스를 만들었거나 업데이트했는지 확인합니다.
  

참고: Terraform 샘플은 일반적으로 필요한 API가 Google Cloud 프로젝트에서 사용 설정되었다고 가정합니다.

--- 탭: tabpanel-python ---
이 코드 샘플을 사용하기 전에 google-cloud-bigquery-reservation 패키지 [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest?hl=ko]를 설치합니다.

  
  
    
ReservationServiceClient [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.services.reservation_service.ReservationServiceClient?hl=ko#google_cloud_bigquery_reservation_v1_services_reservation_service_ReservationServiceClient]를 구성합니다. 예약 [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.types.Reservation?hl=ko]을 사용해서 만들려는 예약을 설명합니다.
create_reservation [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.services.reservation_service.ReservationServiceClient?hl=ko#google_cloud_bigquery_reservation_v1_services_reservation_service_ReservationServiceClient_create_reservation] 메서드를 사용하여 예약을 만듭니다.

  
  
  




















  





  
    
  
  











  









  




  



  


  # TODO(developer): Set project_id to the project ID containing the
# reservation.
project_id = "your-project-id"

# TODO(developer): Set location to the location of the reservation.
# See: https://cloud.google.com/bigquery/docs/locations for a list of
# available locations.
location = "US"

# TODO(developer): Set reservation_id to a unique ID of the reservation.
reservation_id = "sample-reservation"

# TODO(developer): Set slot_capicity to the number of slots in the
# reservation.
slot_capacity = 100

# TODO(developer): Choose a transport to use. Either 'grpc' or 'rest'
transport = "grpc"

# ...

from google.cloud.bigquery_reservation_v1.services import reservation_service
from google.cloud.bigquery_reservation_v1.types import (
    reservation as reservation_types,
)

reservation_client = reservation_service.ReservationServiceClient(
    transport=transport
)

parent = reservation_client.common_location_path(project_id, location)

reservation = reservation_types.Reservation(slot_capacity=slot_capacity)
reservation = reservation_client.create_reservation(
    parent=parent,
    reservation=reservation,
    reservation_id=reservation_id,
)

print(f"Created reservation: {reservation.name}")
예측 가능한 예약 만들기
최대 슬롯 수 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#predictable]로 예약을 만들기 전에 먼저 예약 기반 공정성 [https://cloud.google.com/bigquery/docs/slots?hl=ko#fairness]을 사용 설정해야 합니다.
예약 기반 공정성 사용 설정
예약 기반 공정성을 사용 설정하려면 enable_reservation_based_fairness 플래그 [https://cloud.google.com/bigquery/docs/default-configuration?hl=ko]를 true로 설정합니다.
프로젝트의 예약 기반 공정성을 업데이트하려면 예약 소유권을 유지하는 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]에 대한 bigquery.config.update 권한이 필요합니다. 사전 정의된 BigQuery Admin 역할에 이 권한이 포함되어 있습니다.
프로젝트의 기본 구성을 업데이트하는 방법에 대한 자세한 내용은 구성 설정 관리 [https://cloud.google.com/bigquery/docs/default-configuration?hl=ko#required_permissions]를 참조하세요.
ALTER PROJECT `
PROJECT_NAME` SET OPTIONS (
    `region-
LOCATION.enable_reservation_based_fairness`= true);
다음을 바꿉니다.
PROJECT_NAME: 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]
예측 가능한 예약 만들기
최대 슬롯 수를 사용하여 예측 가능한 예약을 만들려면 다음 옵션 중 하나를 선택합니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
탐색 패널에서 용량 관리 섹션으로 이동하고 예약 만들기를 클릭합니다.
예약 이름 필드에 예약 이름을 입력합니다.
위치 목록에서 위치를 선택합니다. BigQuery Omni 위치 [https://cloud.google.com/bigquery/docs/omni-introduction?hl=ko#locations]를 선택하면 버전 옵션이 Enterprise 버전으로 제한됩니다.
버전 목록에서 버전을 선택합니다. 자동 확장은 한 버전 내에서만 사용할 수 있습니다. 자세한 내용은 BigQuery 버전 이해 [https://cloud.google.com/bigquery/docs/editions-intro?hl=ko]를 참조하세요.
최대 예약 크기 선택기 목록에서 최대 예약 크기를 선택합니다.
(선택사항) 기준 슬롯 필드에 예약의 기준 슬롯 수를 입력합니다.

사용 가능한 자동 확장 슬롯 수는 최대 예약 크기에서 기준 슬롯 값을 빼서 결정됩니다. 예를 들어 기준 슬롯이 100개이고 최대 예약 크기가 400개인 예약을 만들면 예약의 자동 확장 슬롯은 300개입니다. 기준 슬롯에 대한 자세한 내용은 기준 및 자동 확장 슬롯이 있는 예약 사용 [https://cloud.google.com/bigquery/docs/slots-autoscaling-intro?hl=ko#using_reservations_with_baseline_and_autoscaling_slots]을 참조하세요.
유휴 슬롯 공유 [https://cloud.google.com/bigquery/docs/slots?hl=ko#idle_slots]를 사용 중지하고 지정된 슬롯 용량만 사용하려면 유휴 슬롯 무시 전환 버튼을 클릭합니다.
고급 설정 섹션을 펼치려면 expand_more 펼치기 화살표를 클릭합니다.


유휴 슬롯을 어떻게 사용하시겠어요? 목록에서 구성 옵션을 선택합니다.

슬롯 분석은 예상 비용 테이블에 표시됩니다.
예약 요약은 용량 요약 테이블에 표시됩니다.
저장을 클릭합니다.


새 예약이 슬롯 예약 탭에 표시됩니다.

--- 탭: bq [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#bq] ---
예측 가능한 예약을 만들려면 bq mk 명령어를 --reservation 플래그와 함께 사용하고 max_slots 및 scaling_mode 값을 설정합니다.

bq mk \
    --project_id=ADMIN_PROJECT_ID \
    --location=LOCATION \
    --reservation \
    --slots=NUMBER_OF_BASELINE_SLOTS \
    --ignore_idle_slots=false \
    --edition=EDITION \
    --max_slots=MAXIMUM_NUMBER_OF_SLOTS \
    --scaling_mode=SCALING_MODE
    RESERVATION_NAME


다음을 바꿉니다.


ADMIN_PROJECT_ID: 프로젝트 ID
LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko] BigQuery Omni 위치 [https://cloud.google.com/bigquery/docs/omni-introduction?hl=ko#locations]를 선택하면 버전 옵션이 Enterprise 버전으로 제한됩니다.
NUMBER_OF_BASELINE_SLOTS: 예약에 할당할 기준 슬롯 수입니다.
RESERVATION_NAME: 예약 이름
EDITION: 예약 버전. 버전에 예약을 할당하면 기능 및 가격이 변경됩니다. 자세한 내용은 BigQuery 버전 소개 [https://cloud.google.com/bigquery/docs/editions-intro?hl=ko]를 참조하세요.
MAXIMUM_NUMBER_OF_SLOTS: 예약에서 사용할 수 있는 최대 슬롯 수입니다. 이 값은 --scaling_mode 플래그(프리뷰 [https://cloud.google.com/products?hl=ko#product-launch-stages])로 구성해야 합니다.
SCALING_MODE: 예약의 확장 모드입니다. 옵션은 ALL_SLOTS, IDLE_SLOTS_ONLY 또는 AUTOSCALE_ONLY입니다. 이 값은 --scaling_mode 플래그(프리뷰 [https://cloud.google.com/products?hl=ko#product-launch-stages])로 구성해야 합니다.


--ignore_idle_slots 플래그에 대한 자세한 내용은 유휴 슬롯 [https://cloud.google.com/bigquery/docs/slots?hl=ko#idle_slots]을 참조하세요. 기본값은 false입니다.
예측 가능한 예약에 대해 자세히 알아보려면 예측 가능한 예약 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#predictable]을 참조하세요.
예약 업데이트
예약을 다음과 같이 업데이트할 수 있습니다.
슬롯을 추가하거나 삭제하여 예약 크기를 변경합니다.
이 예약의 쿼리가 유휴 슬롯을 사용하는지 여부를 구성합니다.
예약에 할당된 기준 또는 자동 확장 슬롯의 양을 변경합니다.
대상 작업 동시 실행을 설정합니다.
예약 버전을 변경하려면 먼저 예약을 삭제 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#delete_reservations]한 후 업데이트된 버전으로 예약을 만듭니다 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#create_reservations].
필수 권한
예약을 업데이트하려면 다음 Identity and Access Management(IAM) 권한이 필요합니다.
약정의 소유권을 유지하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 bigquery.reservations.update
사전 정의된 다음의 각 IAM 역할에는 이 권한이 포함되어 있습니다.
BigQuery Admin
BigQuery Resource Admin
BigQuery Resource Editor
BigQuery에서 IAM 역할에 대한 자세한 내용은 사전 정의된 역할 및 권한 [https://cloud.google.com/bigquery/docs/access-control?hl=ko]을 참조하세요.
예약 크기 변경
기존 예약에서 슬롯을 추가하거나 삭제할 수 있습니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
탐색 메뉴에서 용량 관리를 클릭합니다.
슬롯 예약 탭을 클릭합니다.
업데이트할 예약을 찾습니다.
more_vert
작업 옵션을 확장합니다.
수정을 클릭합니다.
최대 예약 크기 선택기 대화상자에 최대 예약 크기를 입력합니다.
기준 슬롯 필드에 기준 슬롯 수를 입력합니다.
고급 설정 섹션을 펼치려면 expand_more 펼치기 화살표를 클릭합니다.
(선택사항): 대상 작업 동시 실행을 설정하려면 자동 대상 작업 동시 실행 재정의 전환 버튼을 클릭하여 대상 작업 동시 실행을 입력합니다.
저장을 클릭합니다.

--- 탭: SQL [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#sql] ---
예약 크기를 변경하려면 ALTER RESERVATION SET OPTIONS 데이터 정의 언어(DDL) 문 [https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language?hl=ko#alter_reservation_set_options_statement]을 사용합니다.






 Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
쿼리 편집기에서 다음 문을 입력합니다.

ALTER RESERVATION
  `ADMIN_PROJECT_ID.region-LOCATION.RESERVATION_NAME`
SET OPTIONS (
  slot_capacity = NUMBER_OF_BASELINE_SLOTS,
  autoscale_max_slots = NUMBER_OF_AUTOSCALING_SLOTS);


다음을 바꿉니다.

  ADMIN_PROJECT_ID: 예약 리소스를 소유하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
  LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko](예: europe-west9)
  RESERVATION_NAME: 예약 이름. 이름에는 소문자 영숫자 문자 또는 대시만 포함할 수 있고, 문자로 시작해야 하며 대시로 끝나서는 안 되고, 최대 길이는 64자입니다.
  NUMBER_OF_BASELINE_SLOTS: 예약에 할당할 기준 슬롯 수.
  
  NUMBER_OF_AUTOSCALING_SLOTS: 예약에 할당된 자동 확장 슬롯 수. 최대 예약 크기 값에서 기준 슬롯 수를 뺀 값과 동일합니다.
  


play_circle 실행을 클릭합니다.




쿼리를 실행하는 방법에 대한 자세한 내용은 대화형 쿼리 실행 [https://cloud.google.com/bigquery/docs/running-queries?hl=ko#queries]을 참조하세요.

--- 탭: bq [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#bq] ---
예약 크기를 업데이트하려면 bq update 명령어를 --reservation 플래그와 함께 사용합니다.

bq update \
    --project_id=ADMIN_PROJECT_ID \
    --location=LOCATION \
    --slots=NUMBER_OF_BASELINE_SLOTS \
    --autoscale_max_slots=NUMBER_OF_AUTOSCALING_SLOTS \
    --reservation RESERVATION_NAME


다음을 바꿉니다.


ADMIN_PROJECT_ID: 프로젝트 ID
LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]
NUMBER_OF_BASELINE_SLOTS: 예약에 할당할 기준 슬롯 수
RESERVATION_NAME: 예약 이름. 이름에는 소문자 영숫자 문자 또는 대시만 포함할 수 있고, 문자로 시작해야 하며 대시로 끝나서는 안 되고, 최대 길이는 64자입니다.
NUMBER_OF_AUTOSCALING_SLOTS: 예약에 할당된 자동 확장 슬롯 수. 최대 예약 크기 값에서 기준 슬롯 수를 뺀 값과 동일합니다.

--- 탭: Python [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#python] ---
이 코드 샘플을 사용하기 전에 google-cloud-bigquery-reservation 패키지 [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest?hl=ko]를 설치합니다.

  
  
    
ReservationServiceClient [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.services.reservation_service.ReservationServiceClient?hl=ko#google_cloud_bigquery_reservation_v1_services_reservation_service_ReservationServiceClient]를 구성합니다. Reservation [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.types.Reservation?hl=ko] 및 FieldMask.paths [https://googleapis.dev/python/protobuf/latest/google/protobuf/field_mask_pb2.html#google.protobuf.field_mask_pb2.FieldMask.paths] 속성을 사용하여 업데이트된 속성을 설명합니다.
update_reservation [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.services.reservation_service.ReservationServiceClient?hl=ko#google_cloud_bigquery_reservation_v1_services_reservation_service_ReservationServiceClient_update_reservation] 메서드를 사용하여 예약을 업데이트합니다.

  
  
  




















  





  
    
  
  











  









  




  



  


  # TODO(developer): Set project_id to the project ID containing the
# reservation.
project_id = "your-project-id"

# TODO(developer): Set location to the location of the reservation.
# See: https://cloud.google.com/bigquery/docs/locations for a list of
# available locations.
location = "US"

# TODO(developer): Set reservation_id to a unique ID of the reservation.
reservation_id = "sample-reservation"

# TODO(developer): Set slot_capicity to the new number of slots in the
# reservation.
slot_capacity = 50

# TODO(developer): Choose a transport to use. Either 'grpc' or 'rest'
transport = "grpc"

# ...

from google.cloud.bigquery_reservation_v1.services import reservation_service
from google.cloud.bigquery_reservation_v1.types import (
    reservation as reservation_types,
)
from google.protobuf import field_mask_pb2

reservation_client = reservation_service.ReservationServiceClient(
    transport=transport
)

reservation_name = reservation_client.reservation_path(
    project_id, location, reservation_id
)
reservation = reservation_types.Reservation(
    name=reservation_name,
    slot_capacity=slot_capacity,
)
field_mask = field_mask_pb2.FieldMask(paths=["slot_capacity"])
reservation = reservation_client.update_reservation(
    reservation=reservation, update_mask=field_mask
)

print(f"Updated reservation: {reservation.name}")
print(f"\tslot_capacity: {reservation.slot_capacity}")
쿼리에서 유휴 슬롯을 사용할지 구성
--ignore_idle_slots 플래그는 예약에서 실행 중인 쿼리가 다른 예약의 유휴 슬롯을 사용할 수 있는지 여부를 제어합니다. 자세한 내용은 유휴 슬롯 [https://cloud.google.com/bigquery/docs/slots?hl=ko#idle_slots]을 참조하세요. 기존 예약에서 이 구성을 업데이트할 수 있습니다.
예약을 업데이트하려면 bq update 명령어를 --reservation 플래그와 함께 실행합니다. 다음 예시에서는 --ignore_idle_slots를 true로 설정합니다. 즉, 예약이 예약에 할당된 슬롯만 사용합니다.
bq update \
    --project_id=
ADMIN_PROJECT_ID \
    --location=
LOCATION \
    --ignore_idle_slots=true \
    --reservation 
RESERVATION_NAME
다음을 바꿉니다.
ADMIN_PROJECT_ID: 프로젝트 ID
LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]
RESERVATION_NAME: 예약 이름. 이름에는 소문자 영숫자 문자 또는 대시만 포함할 수 있고, 문자로 시작해야 하며 대시로 끝나서는 안 되고, 최대 길이는 64자입니다.
유휴 슬롯 구성 나열
예약의 유휴 슬롯 [https://cloud.google.com/bigquery/docs/slots?hl=ko#idle_slots] 설정을 나열하려면 다음을 수행합니다.
--- 탭: SQL [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#sql] ---
INFORMATION_SCHEMA.RESERVATIONS_BY_PROJECT [https://cloud.google.com/bigquery/docs/information-schema-reservations?hl=ko#schema] 뷰의 ignore_idle_slots 열을 쿼리합니다.






 Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
쿼리 편집기에서 다음 문을 입력합니다.

SELECT
  reservation_name,
  ignore_idle_slots
FROM
  `ADMIN_PROJECT_ID.region-LOCATION`.INFORMATION_SCHEMA.RESERVATIONS_BY_PROJECT;


다음을 바꿉니다.

  ADMIN_PROJECT_ID: 예약 리소스를 소유하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
  LOCATION: 예약의 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]


play_circle 실행을 클릭합니다.




쿼리를 실행하는 방법에 대한 자세한 내용은 대화형 쿼리 실행 [https://cloud.google.com/bigquery/docs/running-queries?hl=ko#queries]을 참조하세요.

--- 탭: bq [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#bq] ---
bq ls 명령어를 --reservation 플래그와 함께 사용합니다.

bq ls --reservation \
    --project_id=ADMIN_PROJECT_ID \
    --location=LOCATION


다음을 바꿉니다.


ADMIN_PROJECT_ID: 예약 리소스를 소유하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
LOCATION: 예약의 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]


ignoreIdleSlots 필드에는 구성 설정이 포함됩니다.
예약 삭제
예약을 삭제하면 현재 해당 예약의 슬롯에서 실행 중인 모든 작업이 실패합니다. 오류를 방지하려면 예약을 삭제하기 전에 실행 중인 작업이 완료될 수 있도록 합니다.
필수 권한
예약을 삭제하려면 다음 Identity and Access Management(IAM) 권한이 필요합니다.
약정의 소유권을 유지하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 bigquery.reservations.delete
사전 정의된 다음의 각 IAM 역할에는 이 권한이 포함되어 있습니다.
BigQuery Admin
BigQuery Resource Admin
BigQuery Resource Editor
BigQuery에서 IAM 역할에 대한 자세한 내용은 사전 정의된 역할 및 권한 [https://cloud.google.com/bigquery/docs/access-control?hl=ko]을 참조하세요.
주의: 활성 약정이 있는 예약은 삭제할 수 있지만 약정 기간의 남은 기간에 대한 요금은 청구됩니다. 예약을 삭제하거나 연결된 프로젝트를 주문형 가격 책정으로 전환해도 이러한 청구는 중지되지 않습니다. 약정 만료에 대한 자세한 내용은 약정 만료 [https://cloud.google.com/bigquery/docs/reservations-commitments?hl=ko#commitment_expiration]를 참고하세요. 예약, 약정, 비용과 관련하여 도움이 더 필요하면 Google Cloud 지원팀 [https://cloud.google.com/bigquery/docs/getting-support?hl=ko]에 문의하세요.
예약 삭제
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
탐색 메뉴에서 용량 관리를 클릭합니다.
예약 탭을 클릭합니다.
삭제할 예약을 찾습니다.
more_vert
작업 옵션을 확장합니다.
삭제를 클릭합니다.
예약 삭제 대화상자에서 삭제를 클릭합니다.

--- 탭: SQL [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#sql] ---
예약을 삭제하려면 DROP RESERVATION DDL 문 [https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language?hl=ko#drop_reservation_statement]을 사용합니다.






 Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.

BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko] 
쿼리 편집기에서 다음 문을 입력합니다.

DROP RESERVATION
  `ADMIN_PROJECT_ID.region-LOCATION.RESERVATION_NAME`;


다음을 바꿉니다.

  ADMIN_PROJECT_ID: 예약 리소스를 소유하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
  LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]
  RESERVATION_NAME: 예약의 ID


play_circle 실행을 클릭합니다.




쿼리를 실행하는 방법에 대한 자세한 내용은 대화형 쿼리 실행 [https://cloud.google.com/bigquery/docs/running-queries?hl=ko#queries]을 참조하세요.

--- 탭: bq [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#bq] ---
예약을 삭제하려면 bq rm 명령어를 --reservation 플래그와 함께 실행합니다.

bq rm \
    --project_id=ADMIN_PROJECT_ID \
    --location=LOCATION \
    --reservation RESERVATION_NAME


다음을 바꿉니다.


ADMIN_PROJECT_ID: 예약 리소스를 소유하는 관리 프로젝트 [https://cloud.google.com/bigquery/docs/reservations-workload-management?hl=ko#admin-project]의 프로젝트 ID
LOCATION: 예약 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko]
RESERVATION_NAME: 예약 이름. 이름에는 소문자 영숫자 문자 또는 대시만 포함할 수 있고, 문자로 시작해야 하며 대시로 끝나서는 안 되고, 최대 길이는 64자입니다.

--- 탭: Python [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#python] ---
이 코드 샘플을 사용하기 전에 google-cloud-bigquery-reservation 패키지 [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest?hl=ko]를 설치합니다.

  
  
    
ReservationServiceClient [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.services.reservation_service.ReservationServiceClient?hl=ko#google_cloud_bigquery_reservation_v1_services_reservation_service_ReservationServiceClient]를 구성합니다.
delete_reservation [https://cloud.google.com/python/docs/reference/bigqueryreservation/latest/google.cloud.bigquery_reservation_v1.services.reservation_service.ReservationServiceClient?hl=ko#google_cloud_bigquery_reservation_v1_services_reservation_service_ReservationServiceClient_delete_reservation] 메서드를 사용하여 예약을 삭제합니다.

  
  
  




















  





  
    
  
  











  









  




  



  


  # TODO(developer): Set project_id to the project ID containing the
# reservation.
project_id = "your-project-id"

# TODO(developer): Set location to the location of the reservation.
# See: https://cloud.google.com/bigquery/docs/locations for a list of
# available locations.
location = "US"

# TODO(developer): Set reservation_id to a unique ID of the reservation.
reservation_id = "sample-reservation"

# TODO(developer): Choose a transport to use. Either 'grpc' or 'rest'
transport = "grpc"

# ...

from google.cloud.bigquery_reservation_v1.services import reservation_service

reservation_client = reservation_service.ReservationServiceClient(
    transport=transport
)
reservation_name = reservation_client.reservation_path(
    project_id, location, reservation_id
)
reservation_client.delete_reservation(name=reservation_name)

print(f"Deleted reservation: {reservation_name}")
예약에 대한 액세스 제어
프리뷰
이 제품 또는 기능에는 서비스별 약관 [https://cloud.google.com/terms/service-terms?hl=ko#1]의 일반 서비스 약관 섹션에 있는 'GA 이전 제공 서비스 약관'이 적용됩니다. GA 이전 제품 및 기능은 '있는 그대로' 제공되며 지원이 제한될 수 있습니다. 자세한 내용은 출시 단계 설명 [https://cloud.google.com/products?hl=ko#product-launch-stages]을 참조하세요.
이 기능에 대한 지원을 요청하거나 의견을 제공하려면 bigquery-wlm-feedback@google.com [mailto:bigquery-wlm-feedback@google.com]으로 문의하세요.
특정 예약에 액세스할 수 있는 사용자를 관리할 수 있습니다. 사용자가 쿼리에서 예약을 재정의하려면 해당 예약에 대한 reservations.use 권한이 있어야 합니다.
필수 권한
작업에 특정 예약을 지정하는 데 필요한 권한을 얻으려면 관리자에게 예약 리소스에 대한 예약 편집자 [https://cloud.google.com/iam/docs/roles-permissions/bigquery?hl=ko#bigquery.reservationEditor](roles/bigquery.reservationEditor) IAM 역할을 부여해 달라고 요청하세요. 역할 부여에 대한 자세한 내용은 프로젝트, 폴더, 조직에 대한 액세스 관리 [https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=ko]를 참조하세요.
이 사전 정의된 역할에는 작업에 특정 예약을 지정하는 데 필요한 reservations.use 권한이 포함되어 있습니다.
커스텀 역할 [https://cloud.google.com/iam/docs/creating-custom-roles?hl=ko]이나 다른 사전 정의된 역할 [https://cloud.google.com/iam/docs/roles-overview?hl=ko#predefined]을 사용하여 이 권한을 부여받을 수도 있습니다.
예약에 대한 액세스 제어
예약에 Identity and Access Management(IAM) 조건 [https://cloud.google.com/bigquery/docs/conditions?hl=ko]을 설정하려면 다음 중 하나를 수행하세요.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 IAM 페이지로 이동합니다.

IAM으로 이동 [https://console.cloud.google.com/projectselector/iam-admin/iam?supportedpurview=project%2Cfolder%2CorganizationId&hl=ko]
프로젝트, 폴더, 조직을 선택합니다.
bigquery.resourceEditor 역할을 부여할 주 구성원을 선택합니다.



리소스에 대해 이미 다른 역할이 있는 주 구성원에게 bigquery.resourceEditor 역할을 부여하려면 주 구성원이 포함된 행을 찾아 해당 행에서 edit 주 구성원 수정을 클릭하고 add 다른 역할 추가를 클릭합니다.
리소스에 대해 기존 역할이 없는 주 구성원에게 bigquery.resourceEditor 역할을 부여하려면 person_add 액세스 권한 부여를 클릭한 후 주 구성원의 식별자를 입력합니다(예: my-user@example.com).



드롭다운 목록에서 부여할 bigquery.resourceEditor 역할을 선택합니다.
역할에 조건 [https://cloud.google.com/iam/docs/conditions-overview?hl=ko]을 추가합니다. 예를 들어 /reservation1로 끝나는 모든 예약에 역할을 부여하는 조건을 추가할 수 있습니다.
저장을 클릭합니다. 주 구성원에게 리소스에 대한 역할이 부여됩니다.

--- 탭: bq [https://cloud.google.com/bigquery/docs/reservations-tasks?hl=ko#bq] ---
예약에 대한 액세스 권한을 부여하려면 bq
set-iam-policy [https://cloud.google.com/bigquery/docs/reference/bq-cli-reference?hl=ko#bq_set-iam-policy] 명령어를 사용합니다.

  bq set-iam-policy projects/project1/locations/US << EOF
  resource: "RESOURCE"
  policy {
    bindings {
      role: "roles/bigquery.resourceAdmin"
        members: "user:USER"
        condition {
          title: "title"
          expression: "EXPRESSION"
        }
      }
    }
  update_mask { paths: "bindings" }
  EOF


다음을 바꿉니다.


RESOURCE: 예약 리소스의 이름입니다.
USER: 역할을 부여할 사용자의 이메일입니다.
EXPRESSION: 역할 부여의 기반이 되는 표현식입니다. 예를 들면 resource.name.endsWith(\"/res1\")입니다.
IAM에 대한 자세한 내용은 다른 리소스에 대한 액세스 관리 [https://cloud.google.com/iam/docs/manage-access-other-resources?hl=ko]를 참조하세요.
도움이 되었나요?
의견 보내기