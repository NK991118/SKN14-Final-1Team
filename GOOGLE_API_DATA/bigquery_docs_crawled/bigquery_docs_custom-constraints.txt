Source URL: https://cloud.google.com/bigquery/docs/custom-constraints

BigQuery [https://cloud.google.com/bigquery?hl=ko]
Documentation [https://cloud.google.com/bigquery/docs?hl=ko]
가이드 [https://cloud.google.com/bigquery/docs/introduction?hl=ko]
도움이 되었나요?
의견 보내기
이 페이지의 내용
조직 정책 및 제약조건 정보 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#about_organization_policies_and_constraints]
정책 상속 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#policy-inheritance]
제한사항 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#limitations]
시작하기 전에 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#before-you-begin]
필요한 역할 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#required-roles]
커스텀 제약 조건을 사용하여 BigQuery 리소스 관리
bookmark_border
프리뷰
이 제품 또는 기능에는 서비스별 약관 [https://cloud.google.com/terms/service-terms?hl=ko#1]의 일반 서비스 약관 섹션에 있는 'GA 이전 제공 서비스 약관'이 적용됩니다. GA 이전 제품 및 기능은 '있는 그대로' 제공되며 지원이 제한될 수 있습니다. 자세한 내용은 출시 단계 설명 [https://cloud.google.com/products?hl=ko#product-launch-stages]을 참조하세요.
이 페이지에서는 조직 정책 서비스 커스텀 제약 조건을 사용하여 다음 Google Cloud 리소스에 대한 특정 작업을 제한하는 방법을 보여줍니다.
bigquery.googleapis.com/Dataset
조직 정책에 대한 자세한 내용은 커스텀 조직 정책 [https://cloud.google.com/resource-manager/docs/organization-policy/overview?hl=ko#custom-organization-policies]을 참조하세요.
조직 정책 및 제약조건 정보
Google Cloud 조직 정책 서비스를 사용하면 조직 리소스를 중앙에서 프로그래매틱 방식으로 제어할 수 있습니다. 조직 정책 관리자 [https://cloud.google.com/iam/docs/understanding-roles?hl=ko#orgpolicy.policyAdmin]는 Google Cloud 리소스 계층 구조 [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy?hl=ko]에서Google Cloud 리소스 및 이러한 리소스의 하위 요소에 적용되는 제약조건이라는 제한사항 집합인 조직 정책을 정의할 수 있습니다. 조직, 폴더 또는 프로젝트 수준에서 조직 정책을 적용할 수 있습니다.
조직 정책은 다양한 Google Cloud 서비스에 내장된 관리형 제약조건 [https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=ko]을 제공합니다. 그러나 조직 정책에서 제한되는 특정 필드를 보다 세부적으로 맞춤설정 가능한 방식으로 제어하려면 커스텀 제약조건을 만들고 조직 정책에 이러한 커스텀 제약조건을 사용할 수 있습니다.
정책 상속
기본적으로 조직 정책은 정책을 적용하는 리소스의 하위 요소에 상속됩니다. 예를 들어 폴더에 정책을 적용하면 Google Cloud 가 폴더의 모든 프로젝트에 정책을 적용합니다. 이 동작 및 이를 변경하는 방법에 대한 자세한 내용은 계층 구조 평가 규칙 [https://cloud.google.com/resource-manager/docs/organization-policy/understanding-hierarchy?hl=ko#disallow_inheritance]을 참조하세요.
제한사항
커스컴 제약 조건으로 인해 액세스가 거부되면 PolicyViolationInfo [https://cloud.google.com/dotnet/docs/reference/Google.Cloud.Audit/latest/Google.Cloud.Audit.PolicyViolationInfo?hl=ko]가 BigQuery 감사 로그 [https://cloud.google.com/bigquery/docs/reference/auditlogs?hl=ko]에 게시되지 않습니다. 오류 메시지에는 작업을 거부한 constraintId가 제공됩니다.
시작하기 전에
Sign in to your Google Cloud account. If you're new to Google Cloud, create an account [https://console.cloud.google.com/freetrial?hl=ko] to evaluate how our products perform in real-world scenarios. New customers also get $300 in free credits to run, test, and deploy workloads.
In the Google Cloud console, on the project selector page, select or create a Google Cloud project.
Note: If you don't plan to keep the resources that you create in this procedure, create a project instead of selecting an existing project. After you finish these steps, you can delete the project, removing all resources associated with the project.
Go to project selector [https://console.cloud.google.com/projectselector2/home/dashboard?hl=ko]
Verify that billing is enabled for your Google Cloud project [https://cloud.google.com/billing/docs/how-to/verify-billing-enabled?hl=ko#confirm_billing_is_enabled_on_a_project].
Install [https://cloud.google.com/sdk/docs/install?hl=ko] the Google Cloud CLI.
외부 ID 공급업체(IdP)를 사용하는 경우 먼저 제휴 ID로 gcloud CLI에 로그인 [https://cloud.google.com/iam/docs/workforce-log-in-gcloud?hl=ko]해야 합니다.
gcloud CLI를 초기화하려면 [https://cloud.google.com/sdk/docs/initializing?hl=ko], 다음 명령어를 실행합니다.
gcloud init
조직 ID [https://cloud.google.com/resource-manager/docs/creating-managing-organization?hl=ko#retrieving_your_organization_id]를 알고 있어야 합니다.
필요한 역할
조직 정책을 관리하는 데 필요한 권한을 얻으려면 관리자에게 다음의 IAM 역할을 부여해 달라고 요청합니다.
조직 리소스의 조직 정책 관리자 [https://cloud.google.com/iam/docs/roles-permissions/orgpolicy?hl=ko#orgpolicy.policyAdmin](roles/orgpolicy.policyAdmin)
BigQuery 데이터 세트를 만들거나 업데이트하기: 프로젝트 리소스의 BigQuery 관리자 또는 BigQuery 편집자 [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery](roles/bigquery.admin 또는 roles/bigquery.editor)
역할 부여에 대한 자세한 내용은 프로젝트, 폴더, 조직에 대한 액세스 관리 [https://cloud.google.com/iam/docs/granting-changing-revoking-access?hl=ko]를 참조하세요.
이러한 사전 정의된 역할에는 조직 정책 관리에 필요한 권한이 포함되어 있습니다. 필요한 정확한 권한을 보려면 필수 권한 섹션을 펼치세요.
필수 권한
커스텀 역할 [https://cloud.google.com/iam/docs/creating-custom-roles?hl=ko]이나 다른 사전 정의된 역할 [https://cloud.google.com/iam/docs/roles-overview?hl=ko#predefined]을 사용하여 이 권한을 부여받을 수도 있습니다.
커스텀 제약조건 만들기
커스텀 제약조건은 조직 정책을 적용하는 서비스에서 지원되는 리소스, 메서드, 조건, 작업을 사용하여 YAML 파일에서 정의됩니다. 커스텀 제약조건의 조건은 Common Expression Language(CEL) [https://github.com/google/cel-spec/blob/master/doc/intro.md]를 사용하여 정의됩니다. CEL을 사용해서 커스텀 제약조건에서 조건을 빌드하는 방법은 커스텀 제약조건 만들기 및 관리 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=ko#common_expression_language]의 CEL 섹션을 참조하세요.
커스텀 제약조건을 만들려면 다음 형식을 사용하여 YAML 파일을 만듭니다.
name: organizations/
ORGANIZATION_ID/customConstraints/
CONSTRAINT_NAME
resourceTypes:
- 
RESOURCE_NAME
methodTypes:
- CREATE
- UPDATE
condition: "
CONDITION"
actionType: 
ACTION
displayName: 
DISPLAY_NAME
description: 
DESCRIPTION
다음을 바꿉니다.
ORGANIZATION_ID: 조직 ID(예: 123456789)
CONSTRAINT_NAME: 새 커스텀 제약조건에 사용하려는 이름. 커스텀 제약조건은 custom.으로 시작해야 하며 대문자, 소문자 또는 숫자만 포함할 수 있습니다. 예를 들면 custom.enforceDatasetId입니다. 이 필드의 최대 길이는 70자입니다.
RESOURCE_NAME: 제한하려는 객체 및 필드가 포함된Google Cloud 리소스의 정규화된 이름. 예를 들면 bigquery.googleapis.com/Dataset입니다.
CONDITION: 지원되는 서비스 리소스의 표현에 대해 작성된 CEL 조건 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=ko#common_expression_language]. 이 필드의 최대 길이는 1000자(영문 기준)입니다. 조건을 작성하는 데 사용할 수 있는 리소스에 대한 자세한 내용은 지원되는 리소스 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#supported_resources]를 참조하세요. 예를 들면 "datasetReference.datasetId.startsWith('test')"입니다.
ACTION: condition이 충족될 때 수행할 작업. 가능한 값은 ALLOW 및 DENY입니다.
DISPLAY_NAME: 제약조건에 대한 사용자 친화적인 이름. 이 필드의 최대 길이는 200자(영문 기준)입니다.
DESCRIPTION: 정책을 위반할 때 오류 메시지로 표시할 제약조건에 대한 사용자 친화적인 설명. 이 필드의 최대 길이는 2,000자(영문 기준)입니다.
커스텀 제약조건을 만드는 방법에 대한 자세한 내용은 커스텀 제약조건 정의 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-custom-constraints?hl=ko#defining_custom_constraints]를 참조하세요.
커스텀 제약조건 설정
새 커스텀 제약조건의 YAML 파일을 만든 후에는 조직에서 조직 정책에 사용할 수 있도록 설정해야 합니다. 커스텀 제약조건을 설정하려면 gcloud org-policies set-custom-constraint 명령어를 사용합니다.
gcloud org-policies set-custom-constraint 
CONSTRAINT_PATH
CONSTRAINT_PATH를 커스텀 제약조건 파일의 전체 경로로 바꿉니다. 예를 들면 /home/user/customconstraint.yaml입니다. 완료되면 Google Cloud 조직 정책 목록에서 조직 정책으로 커스텀 제약조건을 사용할 수 있습니다. 커스텀 제약조건이 존재하는지 확인하려면 gcloud org-policies list-custom-constraints 명령어를 사용합니다.
gcloud org-policies list-custom-constraints --organization=
ORGANIZATION_ID
ORGANIZATION_ID를 조직 리소스 ID로 바꿉니다. 자세한 내용은 조직 정책 보기 [https://cloud.google.com/resource-manager/docs/organization-policy/creating-managing-policies?hl=ko#viewing_organization_policies]를 참조하세요.
커스텀 조직 정책 적용
제약조건을 참조하는 조직 정책을 만들고 해당 조직 정책을 Google Cloud 리소스에 적용하여 제약조건을 적용할 수 있습니다.
--- 탭: 콘솔 [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#%EC%BD%98%EC%86%94] ---
Google Cloud 콘솔에서 조직 정책 페이지로 이동합니다.
        조직 정책으로 이동 [https://console.cloud.google.com/iam-admin/orgpolicies?hl=ko] 
      
      
        프로젝트 선택 도구에서 조직 정책을 설정할 프로젝트를 선택합니다.
      
      
        조직 정책 페이지의 목록에서 제약조건을 선택하여 해당 제약조건의 정책 세부정보 페이지를 봅니다.
      
      
        이 리소스의 조직 정책을 구성하려면 정책 관리를 클릭합니다.
      
      
        정책 수정 페이지에서 상위 정책 재정의를 선택합니다.
      
      
        규칙 추가를 클릭합니다.
      
      
        적용 섹션에서 이 조직 정책 적용을 사용 설정할지 여부를 선택합니다.
      
      
        (선택사항) 태그로 조직 정책을 조건부로 만들려면 조건 추가를 클릭합니다. 조건부 규칙을 조직 정책에 추가하면 비조건부 규칙을 최소 하나 이상 추가해야 합니다. 그렇지 않으면 정책을 저장할 수 없습니다. 자세한 내용은 태그를 사용하여 조직 정책 설정 [https://cloud.google.com/resource-manager/docs/organization-policy/tags-organization-policy?hl=ko]을 참조하세요.
      
      
        변경사항 테스트를 클릭하여 조직 정책의 효과를 시뮬레이션합니다. 기존 관리형 제약조건에는 정책 시뮬레이션을 사용할 수 없습니다. 자세한 내용은 정책 시뮬레이터로 조직 정책 변경사항 테스트 [https://cloud.google.com/policy-intelligence/docs/test-organization-policies?hl=ko]를 참조하세요.
      
      
        조직 정책을 완료하고 적용하려면 정책 설정을 클릭합니다. 정책이 적용되는 데 최대 15분이 소요됩니다.

--- 탭: gcloud [https://cloud.google.com/bigquery/docs/custom-constraints?hl=ko#gcloud] ---
불리언 규칙이 있는 조직 정책을 만들려면 제약조건을 참조하는 정책 YAML 파일을 만듭니다.
    
          name: projects/PROJECT_ID/policies/CONSTRAINT_NAME
      spec:
        rules:
        - enforce: true
    
    
      다음을 바꿉니다.
    
    
      
        PROJECT_ID: 제약조건을 적용할 프로젝트
      
      
        CONSTRAINT_NAME: 커스텀 제약조건에 대해 정의된 이름. 예를 들면 custom.enforceDatasetId입니다.
      
    
    
      제약조건이 포함된 조직 정책을 적용하려면 다음 명령어를 실행합니다.
    
        gcloud org-policies set-policy POLICY_PATH
    
    
      POLICY_PATH를 조직 정책 YAML 파일의 전체 경로로 바꿉니다. 정책이 적용되는 데 최대 15분이 소요됩니다.
커스텀 조직 정책 테스트
다음 예시에서는 특정 프로젝트의 모든 새 데이터 세트 ID가 test로 시작하는 것을 금지하는 커스텀 제약조건 및 정책을 만듭니다.
시작하기 전에 다음이 필요합니다.
조직 ID
프로젝트 ID
제약조건 만들기
커스텀 제약조건을 만들려면 다음 단계를 따르세요.
다음 YAML 파일을 만들고 constraint-enforce-datasetId.yaml로 저장합니다.
name: organizations/
ORGANIZATION_ID/customConstraints/custom.enforceDatasetId
resourceTypes:
- bigquery.googleapis.com/Dataset
methodTypes:
- CREATE
condition: "datasetReference.datasetId.startsWith('test')"
actionType: DENY
displayName: Reject test datasets
description: All new datasets can't begin with 'test'.
ORGANIZATION_ID를 조직 ID로 바꿉니다.
이는 모든 새 데이터 세트에 데이터 세트 ID가 test로 시작하면 작업이 거부되는 제약조건을 정의합니다.
제약조건을 적용합니다.
gcloud org-policies set-custom-constraint ~/constraint-enforce-datasetId
제약조건이 있는지 확인합니다.
gcloud org-policies list-custom-constraints --organization=
ORGANIZATION_ID
출력은 다음과 비슷합니다.
CUSTOM_CONSTRAINT                       ACTION_TYPE  METHOD_TYPES   RESOURCE_TYPES                     DISPLAY_NAME
custom.enforceDatasetId                 DENY         CREATE         bigquery.googleapis.com/Dataset    Reject test datasets
...
정책 만들기
이제 정책을 만들어 만든 커스텀 제약조건에 적용합니다.
다음 파일을 policy-enforce-datasetId.yaml로 저장합니다.
name: projects/
PROJECT_ID/policies/custom.enforceDatasetId
spec:
  rules:
  - enforce: true
PROJECT_ID를 프로젝트 ID로 바꿉니다.
정책을 적용합니다.
gcloud org-policies set-policy ~/policy-enforce-datasetId.yaml
정책이 있는지 확인합니다.
gcloud org-policies list --project=
PROJECT_ID
출력은 다음과 비슷합니다.
CONSTRAINT                  LIST_POLICY    BOOLEAN_POLICY    ETAG
custom.enforceDatasetId     -              SET               COCsm5QGENiXi2E=
정책을 적용한 후 Google Cloud 가 정책 시행을 시작할 때까지 2분 정도 기다립니다.
정책 테스트
프로젝트에서 BigQuery 데이터 세트를 만들어 보세요.
bq --location=US mk -d \
    --default_table_expiration 3600 \
    --description "This is my dataset." \
    testdataset
출력은 다음과 같습니다.
Operation denied by custom org policies: ["customConstraints/custom.enforceDatasetId": "All new datasets can't begin with 'test'."]
BigQuery 지원 리소스
다음 표에는 커스텀 제약조건에서 참조할 수 있는 BigQuery 리소스가 나와 있습니다.
리소스 필드
bigquery.googleapis.com/Dataset resource.datasetReference.datasetId
resource.defaultCollation
resource.defaultEncryptionConfiguration.kmsKeyName
resource.defaultPartitionExpirationMs
resource.defaultRoundingMode
resource.defaultTableExpirationMs
resource.description
resource.externalCatalogDatasetOptions.defaultStorageLocationUri
resource.externalCatalogDatasetOptions.parameters
resource.externalDatasetReference.connection
resource.externalDatasetReference.externalSource
resource.friendlyName
resource.isCaseInsensitive
resource.linkedDatasetSource.sourceDataset.datasetId
resource.location
resource.maxTimeTravelHours
resource.storageBillingModel
다음 단계
데이터 세트 속성을 업데이트 [https://cloud.google.com/bigquery/docs/updating-datasets?hl=ko]하는 방법 알아보기
조직 정책 서비스 [https://cloud.google.com/resource-manager/docs/organization-policy/overview?hl=ko] 자세히 알아보기
조직 정책을 만들고 관리 [https://cloud.google.com/resource-manager/docs/organization-policy/using-constraints?hl=ko]하는 방법 자세히 알아보기
관리형 조직 정책 제약조건 [https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=ko]의 전체 목록 참조하기
도움이 되었나요?
의견 보내기