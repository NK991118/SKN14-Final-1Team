Source URL: https://cloud.google.com/bigquery/docs/work-with-saved-queries

BigQuery [https://cloud.google.com/bigquery?hl=ko]
Documentation [https://cloud.google.com/bigquery/docs?hl=ko]
가이드 [https://cloud.google.com/bigquery/docs/introduction?hl=ko]
도움이 되었나요?
의견 보내기
이 페이지의 내용
필수 권한 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#required_permissions]
저장된 쿼리를 만들 수 있는 권한 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#permissions_to_create_saved_queries]
저장된 쿼리를 수정할 수 있는 권한 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#permissions_to_edit_saved_queries]
저장된 쿼리를 볼 수 있는 권한 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#permissions_to_view_saved_queries]
코드 애셋의 기본 리전 설정 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#set_the_default_region_for_code_assets]
저장된 쿼리 만들기
bookmark_border
쿼리 편집기에서 SQL을 작성하면 쿼리를 저장하고 다른 사용자와 쿼리를 공유할 수 있습니다. 저장된 쿼리는 Dataform [https://cloud.google.com/bigquery/docs/query-overview?hl=ko#bigquery-studio]으로 구동되는 BigQuery Studio [https://cloud.google.com/dataform/docs/overview?hl=ko] 코드 애셋입니다.
저장된 쿼리 삭제 및 저장된 쿼리 기록 관리에 대한 자세한 내용은 저장된 쿼리 관리 [https://cloud.google.com/bigquery/docs/manage-saved-queries?hl=ko]를 참조하세요.
필수 권한
저장된 쿼리를 만들고, 수정하고, 확인하기에 적절한 권한을 설정합니다.
Dataform 관리자(roles/dataform.admin) 역할 [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.admin]이 있는 모든 사용자는 프로젝트에서 생성된 모든 저장된 쿼리에 대한 소유자 액세스 권한을 가집니다.
BigQuery ID 및 액세스 관리(IAM)에 대한 자세한 내용은 IAM으로 액세스 제어 [https://cloud.google.com/bigquery/docs/access-control?hl=ko]를 참조하세요.
저장된 쿼리를 만들 수 있는 권한
저장된 쿼리를 만들고 실행하려면 다음 IAM 권한이 필요합니다.
dataform.locations.get
dataform.locations.list
dataform.repositories.list
dataform.repositories.create
참고: dataform.repositories.create 권한이 있는 사용자는 기본 Dataform 서비스 계정과 해당 서비스 계정에 부여된 모든 권한을 사용하여 코드를 실행할 수 있습니다. 자세한 내용은 Dataform 권한의 보안 고려사항 [https://cloud.google.com/dataform/docs/access-control?hl=ko#security-considerations-permissions]을 참조하세요.
이러한 권한은 다음 IAM 역할로부터 얻을 수 있습니다.
BigQuery 작업 사용자(roles/bigquery.jobUser) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.jobUser]
BigQuery 읽기 세션 사용자(roles/bigquery.readSessionUser) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.readSessionUser]
코드 생성자(roles/dataform.codeCreator) [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.codeCreator]
참고: 프로젝트에서 코드 생성자 역할이 할당된 사용자는 Dataform API 또는 Dataform 명령줄 인터페이스(CLI)를 사용하여 해당 프로젝트의 코드 애셋 이름을 나열할 수 있습니다. 관리자가 아닌 사용자가 BigQuery Studio를 사용할 때 직접 만들었거나 공유받은 코드 애셋만 볼 수 있습니다.
저장된 쿼리를 수정할 수 있는 권한
저장된 쿼리를 수정하고 실행하려면 다음 IAM 역할이 필요합니다.
BigQuery 작업 사용자(roles/bigquery.jobUser) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.jobUser]
BigQuery 읽기 세션 사용자(roles/bigquery.readSessionUser) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.readSessionUser]
코드 편집자(roles/dataform.codeEditor) [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.codeEditor]
저장된 쿼리를 볼 수 있는 권한
저장된 쿼리를 보고 실행하려면 다음 IAM 역할이 필요합니다.
BigQuery 작업 사용자(roles/bigquery.jobUser) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.jobUser]
BigQuery 읽기 세션 사용자(roles/bigquery.readSessionUser) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.readSessionUser]
코드 뷰어(roles/dataform.codeViewer) [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.codeViewer]
코드 애셋의 기본 리전 설정
코드 애셋을 처음 만드는 경우 코드 애셋의 기본 리전을 설정합니다. 생성된 후에는 코드 애셋의 리전을 변경할 수 없습니다.
참고: 저장된 쿼리를 만들고 코드 애셋에 사용 중인 것과 다른 기본 리전을 선택하면(예: us-central1을 사용 중일 때 us-west1 선택), 해당 쿼리 및 이후에 만드는 모든 코드 애셋에 기본적으로 새 리전이 사용됩니다. 기존 코드 애셋에는 생성 시 지정된 리전이 계속 사용됩니다.
BigQuery Studio의 모든 코드 애셋은 같은 기본 리전을 사용합니다. 코드 애셋의 기본 리전을 설정하려면 다음 단계를 수행합니다.
BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
탐색기 창에서 코드 애셋을 사용 설정한 프로젝트를 찾습니다.
프로젝트 옆에 있는 more_vert 작업 보기를 클릭한 후 기본 코드 리전 변경을 클릭합니다.
리전에서 코드 애셋에 사용할 리전을 선택합니다.
선택을 클릭합니다.
사용 가능한 리전 목록은 BigQuery Studio 위치 [https://cloud.google.com/bigquery/docs/locations?hl=ko#bqstudio-loc]를 참조하세요.
저장된 쿼리 만들기
저장된 쿼리를 만들려면 다음 단계를 수행합니다.
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
add_box SQL 쿼리를 클릭합니다.
쿼리 편집기에서 유효한 SQL 쿼리를 입력합니다. 예를 들어 공개 데이터 세트 [https://cloud.google.com/bigquery/public-data?hl=ko]를 쿼리할 수 있습니다.
SELECT
  name,
  SUM(number) AS total
FROM
  `bigquery-public-data.usa_names.usa_1910_2013`
GROUP BY
  name
ORDER BY
  total DESC
LIMIT
  10;
저장 > 쿼리 저장을 클릭하거나 Control+S를 누릅니다.
쿼리 저장 대화상자에 저장된 쿼리의 이름을 입력합니다.
선택사항: 나중에 이 저장된 쿼리 및 다른 모든 코드 애셋에 사용되는 리전을 변경하려면 리전에서 새 리전을 선택합니다.
저장을 클릭합니다.
저장된 쿼리의 첫 번째 버전이 생성됩니다.
선택사항: 쿼리를 저장한 후 다음 툴바를 사용하여 쿼리 세부정보 또는 버전 기록 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#open_a_saved_query_version_as_a_new_query]을 확인하거나, 새 댓글을 추가하거나, 기존 댓글에 답글을 달거나, 기존 댓글의 링크를 가져옵니다.
세부정보, 버전 기록, 댓글 툴바 기능은 프리뷰 [https://cloud.google.com/products?hl=ko#product-launch-stages] 버전으로 제공됩니다. 이러한 기능에 대한 의견을 제공하거나 지원을 요청하려면 bqui-workspace-pod@google.com [mailto:bqui-workspace-pod@google.com]으로 이메일을 보내세요.
저장된 쿼리 공유
저장된 쿼리를 사용자와 공유하려면 먼저 해당 사용자에게 저장된 쿼리에 대한 액세스 권한을 부여하고 적절한 IAM 역할에 사용자를 추가합니다. 그런 다음 저장된 쿼리에 대한 링크를 생성하고 해당 링크를 사용자와 공유합니다.
쿼리를 공유한 사용자에게는 쿼리의 최신 버전만 표시됩니다. 명시적으로 저장하지 않은 자동저장된 변경사항은 공유 쿼리에 표시되지 않습니다.
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
탐색기 창에서 프로젝트와 쿼리 폴더를 펼치고 필요한 경우 공유 쿼리 폴더를 펼칩니다. 액세스 권한을 부여할 저장된 쿼리를 찾아 클릭합니다.
person_add공유를 클릭한 다음 권한 관리를 클릭합니다.
권한 관리 창에서 사용자/그룹 추가를 클릭합니다.
새 주 구성원 필드에 주 구성원을 입력합니다.
역할 목록에서 다음 역할 중 하나를 선택합니다.
코드 소유자 [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.codeOwner]: 삭제 또는 공유를 포함하여 저장된 쿼리에 대한 모든 작업을 수행할 수 있습니다.
코드 편집자 [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.codeEditor]: 쿼리를 수정할 수 있습니다.
코드 뷰어 [https://cloud.google.com/dataform/docs/access-control?hl=ko#dataform.codeViewer]: 쿼리를 볼 수 있습니다.
참고: 주 구성원이 저장된 쿼리를 실행하려면 BigQuery 사용자(roles/bigquery.user) [https://cloud.google.com/bigquery/docs/access-control?hl=ko#bigquery.user] 역할도 있어야 합니다.
선택사항: 역할 및 고급 공유 설정의 전체 목록을 보려면 고급 공유를 클릭합니다.
저장을 클릭합니다.
저장된 쿼리 정보로 돌아가려면 닫기를 클릭합니다.
저장된 쿼리의 링크를 생성하려면 person_add공유를 클릭한 다음 링크 가져오기를 클릭합니다.
링크가 클립보드에 복사됩니다.
저장된 쿼리 버전을 새 쿼리로 열기
기존 저장된 쿼리 버전을 새 쿼리로 열려면 다음 단계를 수행합니다.
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
탐색기 창에서 프로젝트와 쿼리 폴더를 펼치고 필요한 경우 공유 쿼리 폴더를 펼칩니다. 저장된 쿼리를 선택합니다.
history 버전 기록을 클릭합니다.
저장된 쿼리 버전 옆에 있는 more_vert 작업 보기를 클릭한 후 새 쿼리로 열기를 클릭합니다.
저장된 쿼리 업데이트
저장된 쿼리의 텍스트를 변경하면 입력을 중단한 후 2초 후에 변경사항이 자동으로 저장되고 버전 기록에 내 변경사항으로 표시됩니다. 자동저장된 변경사항은 쿼리의 새 버전이 아닙니다. 자동저장된 변경사항은 쿼리를 열 때마다 다시 표시되지만, 쿼리의 새 버전 [https://cloud.google.com/bigquery/docs/manage-saved-queries?hl=ko#work_with_saved_query_versions]으로 명시적으로 저장하지 않는 한 다른 사용자에게는 표시되지 않습니다. 자동저장된 쿼리는 프리뷰 [https://cloud.google.com/products?hl=ko#product-launch-stages] 버전입니다.
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
탐색기 창에서 프로젝트와 쿼리 폴더를 펼치고 필요한 경우 공유 쿼리 폴더를 펼칩니다. 저장된 쿼리의 이름을 클릭하여 엽니다.
쿼리를 수정합니다.
수정된 쿼리를 저장하려면 쿼리 저장 > 쿼리 저장을 클릭하거나 Control+S(macOS의 경우 Command+S)를 누릅니다.
쿼리의 새 버전이 생성됩니다.
저장된 쿼리 업로드
로컬 SQL 쿼리를 업로드하여 BigQuery Studio에서 저장된 쿼리로 사용할 수 있습니다. 그러면 업로드된 저장된 쿼리가 Google Cloud 콘솔의 BigQuery 페이지에도 표시됩니다.
저장된 쿼리를 업로드하려면 다음 단계를 수행합니다.
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
탐색기 창에서 프로젝트를 펼친 후 다음 중 하나를 수행합니다.
쿼리 옆에 있는 more_vert 작업 보기 > SQL 쿼리 업로드를 클릭합니다.
Google Cloud 프로젝트 이름 옆에 있는 more_vert 작업 보기 > 프로젝트에 업로드 > SQL 쿼리를 클릭합니다.
SQL 업로드 대화상자의 SQL 필드에서 찾아보기를 클릭한 후 업로드하려는 쿼리를 선택합니다.
선택사항: SQL 이름 필드에서 쿼리 이름을 수정합니다.
리전 필드에서 저장된 쿼리를 업로드할 리전을 선택합니다.
업로드를 클릭합니다.
저장된 쿼리가 탐색기 창에 표시됩니다.
기존 저장된 쿼리
지원 중단: BigQuery Studio [https://cloud.google.com/bigquery/docs/enable-assets?hl=ko]에서 제공하는 저장된 쿼리로 향후 기존 저장된 쿼리를 완전히 대체할 예정입니다. 지원 중단 타임라인을 검토하는 중입니다. 자세한 내용은 기존 저장된 쿼리의 지원 중단 [https://cloud.google.com/bigquery/docs/saved-queries-introduction?hl=ko#classic-saved-queries-deprecation]을 참조하세요. 저장된 쿼리로 마이그레이션하는 방법은 기존 저장된 쿼리 마이그레이션 [https://cloud.google.com/bigquery/docs/manage-saved-queries?hl=ko#migrate_classic_saved_queries]을 참조하세요.
다음 섹션에서는 기존 저장된 쿼리 [https://cloud.google.com/bigquery/docs/saved-queries-introduction?hl=ko#classic_saved_queries]를 만들고 업데이트하는 방법을 알아봅니다. 기존 저장된 쿼리의 공유, 마이그레이션, 삭제에 대한 자세한 내용은 기존 저장된 쿼리 [https://cloud.google.com/bigquery/docs/manage-saved-queries?hl=ko#classic_saved_queries]를 참조하세요.
참고: BigQuery Studio를 사용 설정하지 않은 경우 기존 저장된 쿼리가 (기존)쿼리 폴더 대신 탐색기 창의 저장된 쿼리(NUMBER) 폴더에 표시됩니다.
기존 저장된 쿼리에 필요한 권한
기존 저장된 쿼리에서 만들기, 보기, 업데이트, 삭제를 수행하려면 다음 IAM 권한이 필요합니다.
비공개 기존 저장된 쿼리:
기존 비공개 저장된 쿼리를 만드는 경우에는 특별한 권한이 필요 없습니다. 모든 프로젝트에 비공개 쿼리를 저장할 수 있지만 만든 사용자만 쿼리를 보거나 업데이트하거나 삭제할 수 있습니다.
프로젝트 수준 기존 저장된 쿼리:
프로젝트 수준의 기존 저장된 쿼리를 만들려면 bigquery.savedqueries.create 권한이 필요합니다. bigquery.admin 사전 정의된 역할에는 bigquery.savedqueries.create 권한이 포함됩니다.
프로젝트 수준의 기존 저장된 쿼리를 보려면 bigquery.savedqueries.get 및 bigquery.savedqueries.list 권한이 필요합니다. bigquery.admin과 bigquery.user 사전 정의된 역할에는 bigquery.savedqueries.get 및 bigquery.savedqueries.list 권한이 포함됩니다.
프로젝트 수준의 기존 저장된 쿼리를 업데이트하려면 bigquery.savedqueries.update 권한이 필요합니다. bigquery.admin 사전 정의된 역할에는 bigquery.savedqueries.update 권한이 포함됩니다.
프로젝트 수준의 기존 저장된 쿼리를 삭제하려면 bigquery.savedqueries.delete 권한이 필요합니다. bigquery.admin 사전 정의된 역할에는 bigquery.savedqueries.delete 권한이 포함됩니다.
공개 기존 저장된 쿼리:
기존 공개 저장된 쿼리를 만드는 경우에는 특별한 권한이 필요 없습니다. 모든 프로젝트에 기존 공개 저장된 쿼리를 저장할 수 있지만 만든 사용자만 쿼리를 업데이트하거나 삭제할 수 있습니다. 링크가 있는 모든 사용자가 기존 공개 저장된 쿼리를 볼 수 있습니다.
참고: 프로젝트 수준에서 dataform.repository.list 권한이 부여된 사용자는 프로젝트에서 만든 모든 저장된 쿼리를 볼 수 있습니다.
BigQuery의 IAM 역할에 대한 자세한 내용은 사전 정의된 역할 및 권한 [https://cloud.google.com/bigquery/docs/access-control?hl=ko]을 참조하세요.
기존 저장된 쿼리 만들기
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
add_box SQL 쿼리를 클릭합니다.
쿼리 편집기에서 유효한 SQL 쿼리를 입력합니다. 예를 들어 공개 데이터 세트 [https://cloud.google.com/bigquery/public-data?hl=ko]를 쿼리할 수 있습니다.
SELECT
  name,
  SUM(number) AS total
FROM
  `bigquery-public-data.usa_names.usa_1910_2013`
GROUP BY
  name
ORDER BY
  total DESC
LIMIT
  10;
쿼리 저장(기존) > 쿼리 저장(기존)을 클릭합니다.
쿼리 저장 대화상자에 쿼리 이름을 입력한 다음 공개 상태를 다음 옵션 중 하나로 설정합니다.
기존 비공개 공유 쿼리의 경우 개인(본인만 수정 가능)입니다.
프로젝트 수준의 기존 저장된 쿼리에 대한 프로젝트(적절한 권한이 있는 주 구성원이 수정 가능).
기존 공개 저장된 쿼리의 경우 공개입니다.
저장을 클릭합니다.
기존 저장된 쿼리 공유
프로젝트 또는 공개 상태인 기존 저장된 쿼리를 공유할 수 있습니다. 프로젝트 공개 상태를 사용하면 필요한 권한 [https://cloud.google.com/bigquery/docs/work-with-saved-queries?hl=ko#required_permissions_for_classic_saved_queries]을 가진 주 구성원이 쿼리를 보거나, 업데이트하거나, 삭제할 수 있습니다. 공개 상태가 공개인 경우 쿼리 링크가 있는 모든 사용자가 쿼리를 볼 수 있지만 업데이트하거나 삭제하지는 못합니다.
기존 저장된 쿼리에 대한 링크를 생성하고 공유하여 기존 저장된 쿼리를 다른 사용자와 공유합니다.
기존 공유 쿼리를 실행하려면 사용자에게 쿼리에서 액세스하는 데이터에 대한 액세스 권한이 있어야 합니다. 자세한 내용은 데이터 세트에 대한 액세스 권한 부여 [https://cloud.google.com/bigquery/docs/control-access-to-resources-iam?hl=ko#grant_access_to_a_dataset]를 참조하세요.
기존 저장된 쿼리를 공유하려면 쿼리에 용도를 설명하는 주석을 포함하는 것이 좋습니다.
탐색기 창에서 프로젝트와 (기존) 쿼리 폴더를 펼친 후 공유할 기존 저장된 쿼리를 찾습니다.
쿼리 옆에 있는 more_vert 작업 보기를 클릭한 후 링크 가져오기를 클릭합니다.
쿼리 액세스 권한을 부여하려는 사용자와 링크를 공유합니다.
기존 저장된 쿼리 업데이트
Google Cloud 콘솔에서 BigQuery 페이지로 이동합니다.
BigQuery로 이동 [https://console.cloud.google.com/bigquery?hl=ko]
탐색기 창에서 프로젝트와 (기존) 쿼리 폴더를 펼치고 필요한 경우 프로젝트 쿼리 폴더를 펼칩니다.
기존 저장된 쿼리의 이름을 클릭하여 엽니다.
쿼리를 수정합니다.
수정된 쿼리를 저장하려면 쿼리 저장(기존) > 쿼리 저장(기존)을 클릭합니다.
다음 단계
저장된 쿼리 관리 [https://cloud.google.com/bigquery/docs/manage-saved-queries?hl=ko] 방법 알아보기
도움이 되었나요?
의견 보내기