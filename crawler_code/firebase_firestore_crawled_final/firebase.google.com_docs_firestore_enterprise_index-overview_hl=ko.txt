Source URL: https://firebase.google.com/docs/firestore/enterprise/index-overview?hl=ko
Title: 색인 개요

이제 MongoDB 호환성을 갖춘 Cloud Firestore Enterprise 버전을 사용할 수 있습니다. 자세히 알아보기 [https://firebase.google.com/docs/firestore/enterprise/mongodb-compatibility-overview?hl=ko]

의견 보내기

색인 개요

컬렉션을 사용해 정리하기

내 환경설정을 기준으로 콘텐츠를 저장하고 분류하세요.

| Cloud Firestore Enterprise 버전에만 해당합니다. |
| --- |

이 페이지에서는 MongoDB 호환성을 갖춘 Cloud Firestore의 색인 생성을 설명합니다.
MongoDB 호환성을 갖춘 Cloud Firestore는 기본적으로 색인을 생성하지 않습니다. 데이터베이스 성능을 개선하려면 가장 자주 사용되는 쿼리에 대한 색인을 만드세요.

색인은 데이터베이스 성능에 큰 영향을 미칩니다. 쿼리에 대한 색인이 있으면 데이터베이스는 스캔해야 하는 데이터 양을 줄이고 결과를 정렬하는 데 필요한 작업을 줄여 결과를 효율적으로 반환할 수 있습니다. 하지만 색인 항목은 스토리지 비용과 색인이 생성된 필드에 대한 쓰기 작업 중에 실행되는 작업량을 늘립니다.

색인 정의 및 구조

색인은 다음과 같이 구성됩니다.

컬렉션 ID
지정된 컬렉션의 필드 목록
각 필드의 순서(오름차순 또는 내림차순)

색인은 희소 [https://firebase.google.com/docs/firestore/enterprise/index-overview?hl=ko#sparse_indexes], 멀티 키 [https://firebase.google.com/docs/firestore/enterprise/index-overview?hl=ko#multikey] 또는 고유 [https://firebase.google.com/docs/firestore/enterprise/index-overview?hl=ko#unique_indexes] 옵션을 사용 설정할 수도 있습니다.

색인 순서

각 필드의 순서와 정렬 방향은 색인을 고유하게 정의합니다. 예를 들어 다음 색인은 서로 다른 두 개의 색인이며 서로 바꿔 사용할 수 없습니다.

| 컬렉션 | 필드 |
| --- | --- |
| cities | 국가(오름차순), 인구(내림차순) |
| cities | 인구(내림차순), 국가(오름차순) |

쿼리를 지원하는 색인을 만들 때는 쿼리와 동일한 순서로 필드를 포함합니다.

색인 밀도

기본적으로 색인 항목은 컬렉션의 모든 문서에서 데이터를 저장합니다. 이를 비희소 색인이라고 합니다. 문서에 색인에 지정된 필드가 포함되어 있는지 여부와 관계없이 문서에 색인 항목이 추가됩니다.
존재하지 않는 필드는 색인 항목을 생성할 때 NULL 값을 갖는 것으로 처리됩니다. 이 동작을 변경하려면 색인을 희소 색인으로 정의하면 됩니다.

희소 색인

희소 색인은 색인이 생성된 필드 중 하나 이상에 값(null 포함)이 포함된 컬렉션의 문서만 색인을 생성합니다. 희소 색인은 스토리지 비용을 줄이고 성능을 향상시킬 수 있습니다.

배열 값의 멀티 키 색인

배열 값이 포함된 필드에 색인을 만드는 경우 멀티 키 색인을 만들어야 합니다. 일반 색인은 배열 값의 색인을 생성할 수 없습니다. 멀티 키 색인은 색인 정의에서 최대 하나의 배열 필드를 지원하며 배열 값을 순회하는 작업에 사용할 수 있습니다.

배열 값의 색인을 생성해야 하는 경우에만 멀티 키 색인을 사용하세요.
일반 색인은 쿼리를 처리할 때 장점이 있습니다. 예를 들어 일반 색인은 범위 내의 값을 더 효율적으로 필터링할 수 있습니다.

다음과 같은 상황에서는 배열 값과 멀티 키 색인을 사용할 때 오류가 발생합니다.

작업에서 일반 색인으로 색인이 생성된 필드에 배열 값을 추가하려고 합니다. 배열 값을 추가하려면 해당 필드의 기존 일반 색인을 삭제하고 멀티 키 색인으로 다시 만들어야 합니다.
배열 값을 포함하는 필드에 일반 색인을 만들려고 시도합니다. 멀티 키 색인을 만들거나 배열 값을 삭제해야 합니다.
작업에서 배열 값이 있는 여러 필드의 색인을 생성하려고 합니다. 멀티 키 색인에는 배열 값이 있는 필드가 두 개 이상 있을 수 없습니다.
계속하려면 데이터 모델 또는 색인 정의를 수정하세요.
두 필드 경로가 users.posts 및 users.zip과 같은 공통 프리픽스를 공유하는 멀티 키 색인을 만들려고 합니다.

고유 색인

색인이 생성된 필드에 고유한 값을 적용하도록 고유 색인 옵션을 설정합니다.
여러 필드의 색인의 경우 값의 각 조합이 색인에서 고유해야 합니다. 데이터베이스는 중복된 값이 있는 색인 항목을 만들려고 하는 업데이트 및 삽입 작업을 거부합니다. 색인이 생성된 필드의 데이터에 중복 값이 포함되어 있고 고유 색인을 만들려고 하면 작업 세부정보에 오류 메시지가 표시되면서 색인 빌드가 실패합니다.

고유 색인에 없는 필드

고유 색인의 필드가 누락된 문서를 삽입하면 색인은 누락된 필드에 null 값을 설정합니다. 결과 색인 항목은 고유해야 합니다. 그렇지 않으면 작업이 실패합니다.

예를 들어 다음 색인의 경우

db.cities.createIndex( { "name": 1 }, { unique: true } )

문서 {"abbreviation": "LA"}를 컬렉션에 추가하면 고유 색인에서 name이 null로 설정된 항목을 만듭니다. 그런 다음 문서 {"abbreviation": "NYC"}를 추가하려고 하면 고유 색인의 결과 항목이 동일하므로 작업이 실패합니다.

여러 필드가 있는 고유 색인에도 동일한 동작이 적용됩니다.
문서를 만들거나 업데이트할 때 색인이 생성된 필드가 누락되면 null로 설정되며 결과 색인 항목은 색인에서 고유해야 합니다.

색인 빌드 오류 문제 해결

색인을 관리할 때 색인 빌드 오류가 발생할 수 있습니다. 데이터베이스에서 데이터 문제가 발생하면 색인 생성 작업이 실패할 수 있습니다.
다음과 같은 이유로 색인 작업이 실패할 수 있습니다.

색인 한도에 도달했습니다. 예를 들어 작업이 문서당 최대 색인 항목 수에 도달했을 수 있습니다. 색인 생성이 실패하면 오류 메시지가 표시됩니다. 색인 한도에 도달하지 않은 경우 색인 작업을 다시 시도하세요.
멀티 키 색인이 필요합니다. 색인이 생성된 필드 중 하나 이상에 배열 값이 포함되어 있습니다. 계속하려면 멀티 키 색인을 사용하거나 배열 값을 삭제해야 합니다.
작업에서 배열 값이 있는 여러 필드의 색인을 생성하려고 합니다. 멀티 키 색인에는 배열 값이 있는 필드가 두 개 이상 있을 수 없습니다.
계속하려면 데이터 모델 또는 색인 정의를 수정하세요.
고유 색인 옵션을 설정하고 색인이 생성된 필드의 데이터가 중복 색인 항목을 생성합니다. 계속하려면 데이터에서 중복된 값 조합을 삭제하세요.

경고: 진행 중인 색인 빌드 오류가 새 색인 생성에 영향을 미칠 수 있습니다.
동일한 컬렉션에서 색인을 만들기 전에 오류를 해결합니다.
다음 단계

색인 만들기 및 관리 [https://firebase.google.com/docs/firestore/enterprise/indexing?hl=ko] 방법 알아보기

의견 보내기